{"version":3,"file":"index.js","sources":["../node_modules/paho-mqtt/paho-mqtt.js","../src/index.ts"],"sourcesContent":["/*******************************************************************************\n * Copyright (c) 2013 IBM Corp.\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * and Eclipse Distribution License v1.0 which accompany this distribution.\n *\n * The Eclipse Public License is available at\n *    http://www.eclipse.org/legal/epl-v10.html\n * and the Eclipse Distribution License is available at\n *   http://www.eclipse.org/org/documents/edl-v10.php.\n *\n * Contributors:\n *    Andrew Banks - initial API and implementation and initial documentation\n *******************************************************************************/\n\n\n// Only expose a single object name in the global namespace.\n// Everything must go through this module. Global Paho module\n// only has a single public function, client, which returns\n// a Paho client object given connection details.\n\n/**\n * Send and receive messages using web browsers.\n * <p>\n * This programming interface lets a JavaScript client application use the MQTT V3.1 or\n * V3.1.1 protocol to connect to an MQTT-supporting messaging server.\n *\n * The function supported includes:\n * <ol>\n * <li>Connecting to and disconnecting from a server. The server is identified by its host name and port number.\n * <li>Specifying options that relate to the communications link with the server,\n * for example the frequency of keep-alive heartbeats, and whether SSL/TLS is required.\n * <li>Subscribing to and receiving messages from MQTT Topics.\n * <li>Publishing messages to MQTT Topics.\n * </ol>\n * <p>\n * The API consists of two main objects:\n * <dl>\n * <dt><b>{@link Paho.Client}</b></dt>\n * <dd>This contains methods that provide the functionality of the API,\n * including provision of callbacks that notify the application when a message\n * arrives from or is delivered to the messaging server,\n * or when the status of its connection to the messaging server changes.</dd>\n * <dt><b>{@link Paho.Message}</b></dt>\n * <dd>This encapsulates the payload of the message along with various attributes\n * associated with its delivery, in particular the destination to which it has\n * been (or is about to be) sent.</dd>\n * </dl>\n * <p>\n * The programming interface validates parameters passed to it, and will throw\n * an Error containing an error message intended for developer use, if it detects\n * an error with any parameter.\n * <p>\n * Example:\n *\n * <code><pre>\nvar client = new Paho.MQTT.Client(location.hostname, Number(location.port), \"clientId\");\nclient.onConnectionLost = onConnectionLost;\nclient.onMessageArrived = onMessageArrived;\nclient.connect({onSuccess:onConnect});\n\nfunction onConnect() {\n  // Once a connection has been made, make a subscription and send a message.\n  console.log(\"onConnect\");\n  client.subscribe(\"/World\");\n  var message = new Paho.MQTT.Message(\"Hello\");\n  message.destinationName = \"/World\";\n  client.send(message);\n};\nfunction onConnectionLost(responseObject) {\n  if (responseObject.errorCode !== 0)\n\tconsole.log(\"onConnectionLost:\"+responseObject.errorMessage);\n};\nfunction onMessageArrived(message) {\n  console.log(\"onMessageArrived:\"+message.payloadString);\n  client.disconnect();\n};\n * </pre></code>\n * @namespace Paho\n */\n\n/* jshint shadow:true */\n(function ExportLibrary(root, factory) {\n\tif(typeof exports === \"object\" && typeof module === \"object\"){\n\t\tmodule.exports = factory();\n\t} else if (typeof define === \"function\" && define.amd){\n\t\tdefine(factory);\n\t} else if (typeof exports === \"object\"){\n\t\texports = factory();\n\t} else {\n\t\t//if (typeof root.Paho === \"undefined\"){\n\t\t//\troot.Paho = {};\n\t\t//}\n\t\troot.Paho = factory();\n\t}\n})(this, function LibraryFactory(){\n\n\n\tvar PahoMQTT = (function (global) {\n\n\t// Private variables below, these are only visible inside the function closure\n\t// which is used to define the module.\n\tvar version = \"@VERSION@-@BUILDLEVEL@\";\n\n\t/**\n\t * @private\n\t */\n\tvar localStorage = global.localStorage || (function () {\n\t\tvar data = {};\n\n\t\treturn {\n\t\t\tsetItem: function (key, item) { data[key] = item; },\n\t\t\tgetItem: function (key) { return data[key]; },\n\t\t\tremoveItem: function (key) { delete data[key]; },\n\t\t};\n\t})();\n\n\t\t/**\n\t * Unique message type identifiers, with associated\n\t * associated integer values.\n\t * @private\n\t */\n\t\tvar MESSAGE_TYPE = {\n\t\t\tCONNECT: 1,\n\t\t\tCONNACK: 2,\n\t\t\tPUBLISH: 3,\n\t\t\tPUBACK: 4,\n\t\t\tPUBREC: 5,\n\t\t\tPUBREL: 6,\n\t\t\tPUBCOMP: 7,\n\t\t\tSUBSCRIBE: 8,\n\t\t\tSUBACK: 9,\n\t\t\tUNSUBSCRIBE: 10,\n\t\t\tUNSUBACK: 11,\n\t\t\tPINGREQ: 12,\n\t\t\tPINGRESP: 13,\n\t\t\tDISCONNECT: 14\n\t\t};\n\n\t\t// Collection of utility methods used to simplify module code\n\t\t// and promote the DRY pattern.\n\n\t\t/**\n\t * Validate an object's parameter names to ensure they\n\t * match a list of expected variables name for this option\n\t * type. Used to ensure option object passed into the API don't\n\t * contain erroneous parameters.\n\t * @param {Object} obj - User options object\n\t * @param {Object} keys - valid keys and types that may exist in obj.\n\t * @throws {Error} Invalid option parameter found.\n\t * @private\n\t */\n\t\tvar validate = function(obj, keys) {\n\t\t\tfor (var key in obj) {\n\t\t\t\tif (obj.hasOwnProperty(key)) {\n\t\t\t\t\tif (keys.hasOwnProperty(key)) {\n\t\t\t\t\t\tif (typeof obj[key] !== keys[key])\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof obj[key], key]));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar errorStr = \"Unknown property, \" + key + \". Valid properties are:\";\n\t\t\t\t\t\tfor (var validKey in keys)\n\t\t\t\t\t\t\tif (keys.hasOwnProperty(validKey))\n\t\t\t\t\t\t\t\terrorStr = errorStr+\" \"+validKey;\n\t\t\t\t\t\tthrow new Error(errorStr);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t * Return a new function which runs the user function bound\n\t * to a fixed scope.\n\t * @param {function} User function\n\t * @param {object} Function scope\n\t * @return {function} User function bound to another scope\n\t * @private\n\t */\n\t\tvar scope = function (f, scope) {\n\t\t\treturn function () {\n\t\t\t\treturn f.apply(scope, arguments);\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t * Unique message type identifiers, with associated\n\t * associated integer values.\n\t * @private\n\t */\n\t\tvar ERROR = {\n\t\t\tOK: {code:0, text:\"AMQJSC0000I OK.\"},\n\t\t\tCONNECT_TIMEOUT: {code:1, text:\"AMQJSC0001E Connect timed out.\"},\n\t\t\tSUBSCRIBE_TIMEOUT: {code:2, text:\"AMQJS0002E Subscribe timed out.\"},\n\t\t\tUNSUBSCRIBE_TIMEOUT: {code:3, text:\"AMQJS0003E Unsubscribe timed out.\"},\n\t\t\tPING_TIMEOUT: {code:4, text:\"AMQJS0004E Ping timed out.\"},\n\t\t\tINTERNAL_ERROR: {code:5, text:\"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}\"},\n\t\t\tCONNACK_RETURNCODE: {code:6, text:\"AMQJS0006E Bad Connack return code:{0} {1}.\"},\n\t\t\tSOCKET_ERROR: {code:7, text:\"AMQJS0007E Socket error:{0}.\"},\n\t\t\tSOCKET_CLOSE: {code:8, text:\"AMQJS0008I Socket closed.\"},\n\t\t\tMALFORMED_UTF: {code:9, text:\"AMQJS0009E Malformed UTF data:{0} {1} {2}.\"},\n\t\t\tUNSUPPORTED: {code:10, text:\"AMQJS0010E {0} is not supported by this browser.\"},\n\t\t\tINVALID_STATE: {code:11, text:\"AMQJS0011E Invalid state {0}.\"},\n\t\t\tINVALID_TYPE: {code:12, text:\"AMQJS0012E Invalid type {0} for {1}.\"},\n\t\t\tINVALID_ARGUMENT: {code:13, text:\"AMQJS0013E Invalid argument {0} for {1}.\"},\n\t\t\tUNSUPPORTED_OPERATION: {code:14, text:\"AMQJS0014E Unsupported operation.\"},\n\t\t\tINVALID_STORED_DATA: {code:15, text:\"AMQJS0015E Invalid data in local storage key={0} value={1}.\"},\n\t\t\tINVALID_MQTT_MESSAGE_TYPE: {code:16, text:\"AMQJS0016E Invalid MQTT message type {0}.\"},\n\t\t\tMALFORMED_UNICODE: {code:17, text:\"AMQJS0017E Malformed Unicode string:{0} {1}.\"},\n\t\t\tBUFFER_FULL: {code:18, text:\"AMQJS0018E Message buffer is full, maximum buffer size: {0}.\"},\n\t\t};\n\n\t\t/** CONNACK RC Meaning. */\n\t\tvar CONNACK_RC = {\n\t\t\t0:\"Connection Accepted\",\n\t\t\t1:\"Connection Refused: unacceptable protocol version\",\n\t\t\t2:\"Connection Refused: identifier rejected\",\n\t\t\t3:\"Connection Refused: server unavailable\",\n\t\t\t4:\"Connection Refused: bad user name or password\",\n\t\t\t5:\"Connection Refused: not authorized\"\n\t\t};\n\n\t/**\n\t * Format an error message text.\n\t * @private\n\t * @param {error} ERROR value above.\n\t * @param {substitutions} [array] substituted into the text.\n\t * @return the text with the substitutions made.\n\t */\n\t\tvar format = function(error, substitutions) {\n\t\t\tvar text = error.text;\n\t\t\tif (substitutions) {\n\t\t\t\tvar field,start;\n\t\t\t\tfor (var i=0; i<substitutions.length; i++) {\n\t\t\t\t\tfield = \"{\"+i+\"}\";\n\t\t\t\t\tstart = text.indexOf(field);\n\t\t\t\t\tif(start > 0) {\n\t\t\t\t\t\tvar part1 = text.substring(0,start);\n\t\t\t\t\t\tvar part2 = text.substring(start+field.length);\n\t\t\t\t\t\ttext = part1+substitutions[i]+part2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn text;\n\t\t};\n\n\t\t//MQTT protocol and version          6    M    Q    I    s    d    p    3\n\t\tvar MqttProtoIdentifierv3 = [0x00,0x06,0x4d,0x51,0x49,0x73,0x64,0x70,0x03];\n\t\t//MQTT proto/version for 311         4    M    Q    T    T    4\n\t\tvar MqttProtoIdentifierv4 = [0x00,0x04,0x4d,0x51,0x54,0x54,0x04];\n\n\t\t/**\n\t * Construct an MQTT wire protocol message.\n\t * @param type MQTT packet type.\n\t * @param options optional wire message attributes.\n\t *\n\t * Optional properties\n\t *\n\t * messageIdentifier: message ID in the range [0..65535]\n\t * payloadMessage:\tApplication Message - PUBLISH only\n\t * connectStrings:\tarray of 0 or more Strings to be put into the CONNECT payload\n\t * topics:\t\t\tarray of strings (SUBSCRIBE, UNSUBSCRIBE)\n\t * requestQoS:\t\tarray of QoS values [0..2]\n\t *\n\t * \"Flag\" properties\n\t * cleanSession:\ttrue if present / false if absent (CONNECT)\n\t * willMessage:  \ttrue if present / false if absent (CONNECT)\n\t * isRetained:\t\ttrue if present / false if absent (CONNECT)\n\t * userName:\t\ttrue if present / false if absent (CONNECT)\n\t * password:\t\ttrue if present / false if absent (CONNECT)\n\t * keepAliveInterval:\tinteger [0..65535]  (CONNECT)\n\t *\n\t * @private\n\t * @ignore\n\t */\n\t\tvar WireMessage = function (type, options) {\n\t\t\tthis.type = type;\n\t\t\tfor (var name in options) {\n\t\t\t\tif (options.hasOwnProperty(name)) {\n\t\t\t\t\tthis[name] = options[name];\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tWireMessage.prototype.encode = function() {\n\t\t// Compute the first byte of the fixed header\n\t\t\tvar first = ((this.type & 0x0f) << 4);\n\n\t\t\t/*\n\t\t * Now calculate the length of the variable header + payload by adding up the lengths\n\t\t * of all the component parts\n\t\t */\n\n\t\t\tvar remLength = 0;\n\t\t\tvar topicStrLength = [];\n\t\t\tvar destinationNameLength = 0;\n\t\t\tvar willMessagePayloadBytes;\n\n\t\t\t// if the message contains a messageIdentifier then we need two bytes for that\n\t\t\tif (this.messageIdentifier !== undefined)\n\t\t\t\tremLength += 2;\n\n\t\t\tswitch(this.type) {\n\t\t\t// If this a Connect then we need to include 12 bytes for its header\n\t\t\tcase MESSAGE_TYPE.CONNECT:\n\t\t\t\tswitch(this.mqttVersion) {\n\t\t\t\tcase 3:\n\t\t\t\t\tremLength += MqttProtoIdentifierv3.length + 3;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tremLength += MqttProtoIdentifierv4.length + 3;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tremLength += UTF8Length(this.clientId) + 2;\n\t\t\t\tif (this.willMessage !== undefined) {\n\t\t\t\t\tremLength += UTF8Length(this.willMessage.destinationName) + 2;\n\t\t\t\t\t// Will message is always a string, sent as UTF-8 characters with a preceding length.\n\t\t\t\t\twillMessagePayloadBytes = this.willMessage.payloadBytes;\n\t\t\t\t\tif (!(willMessagePayloadBytes instanceof Uint8Array))\n\t\t\t\t\t\twillMessagePayloadBytes = new Uint8Array(payloadBytes);\n\t\t\t\t\tremLength += willMessagePayloadBytes.byteLength +2;\n\t\t\t\t}\n\t\t\t\tif (this.userName !== undefined)\n\t\t\t\t\tremLength += UTF8Length(this.userName) + 2;\n\t\t\t\tif (this.password !== undefined)\n\t\t\t\t\tremLength += UTF8Length(this.password) + 2;\n\t\t\t\tbreak;\n\n\t\t\t// Subscribe, Unsubscribe can both contain topic strings\n\t\t\tcase MESSAGE_TYPE.SUBSCRIBE:\n\t\t\t\tfirst |= 0x02; // Qos = 1;\n\t\t\t\tfor ( var i = 0; i < this.topics.length; i++) {\n\t\t\t\t\ttopicStrLength[i] = UTF8Length(this.topics[i]);\n\t\t\t\t\tremLength += topicStrLength[i] + 2;\n\t\t\t\t}\n\t\t\t\tremLength += this.requestedQos.length; // 1 byte for each topic's Qos\n\t\t\t\t// QoS on Subscribe only\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.UNSUBSCRIBE:\n\t\t\t\tfirst |= 0x02; // Qos = 1;\n\t\t\t\tfor ( var i = 0; i < this.topics.length; i++) {\n\t\t\t\t\ttopicStrLength[i] = UTF8Length(this.topics[i]);\n\t\t\t\t\tremLength += topicStrLength[i] + 2;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PUBREL:\n\t\t\t\tfirst |= 0x02; // Qos = 1;\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PUBLISH:\n\t\t\t\tif (this.payloadMessage.duplicate) first |= 0x08;\n\t\t\t\tfirst  = first |= (this.payloadMessage.qos << 1);\n\t\t\t\tif (this.payloadMessage.retained) first |= 0x01;\n\t\t\t\tdestinationNameLength = UTF8Length(this.payloadMessage.destinationName);\n\t\t\t\tremLength += destinationNameLength + 2;\n\t\t\t\tvar payloadBytes = this.payloadMessage.payloadBytes;\n\t\t\t\tremLength += payloadBytes.byteLength;\n\t\t\t\tif (payloadBytes instanceof ArrayBuffer)\n\t\t\t\t\tpayloadBytes = new Uint8Array(payloadBytes);\n\t\t\t\telse if (!(payloadBytes instanceof Uint8Array))\n\t\t\t\t\tpayloadBytes = new Uint8Array(payloadBytes.buffer);\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.DISCONNECT:\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// Now we can allocate a buffer for the message\n\n\t\t\tvar mbi = encodeMBI(remLength);  // Convert the length to MQTT MBI format\n\t\t\tvar pos = mbi.length + 1;        // Offset of start of variable header\n\t\t\tvar buffer = new ArrayBuffer(remLength + pos);\n\t\t\tvar byteStream = new Uint8Array(buffer);    // view it as a sequence of bytes\n\n\t\t\t//Write the fixed header into the buffer\n\t\t\tbyteStream[0] = first;\n\t\t\tbyteStream.set(mbi,1);\n\n\t\t\t// If this is a PUBLISH then the variable header starts with a topic\n\t\t\tif (this.type == MESSAGE_TYPE.PUBLISH)\n\t\t\t\tpos = writeString(this.payloadMessage.destinationName, destinationNameLength, byteStream, pos);\n\t\t\t// If this is a CONNECT then the variable header contains the protocol name/version, flags and keepalive time\n\n\t\t\telse if (this.type == MESSAGE_TYPE.CONNECT) {\n\t\t\t\tswitch (this.mqttVersion) {\n\t\t\t\tcase 3:\n\t\t\t\t\tbyteStream.set(MqttProtoIdentifierv3, pos);\n\t\t\t\t\tpos += MqttProtoIdentifierv3.length;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tbyteStream.set(MqttProtoIdentifierv4, pos);\n\t\t\t\t\tpos += MqttProtoIdentifierv4.length;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tvar connectFlags = 0;\n\t\t\t\tif (this.cleanSession)\n\t\t\t\t\tconnectFlags = 0x02;\n\t\t\t\tif (this.willMessage !== undefined ) {\n\t\t\t\t\tconnectFlags |= 0x04;\n\t\t\t\t\tconnectFlags |= (this.willMessage.qos<<3);\n\t\t\t\t\tif (this.willMessage.retained) {\n\t\t\t\t\t\tconnectFlags |= 0x20;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.userName !== undefined)\n\t\t\t\t\tconnectFlags |= 0x80;\n\t\t\t\tif (this.password !== undefined)\n\t\t\t\t\tconnectFlags |= 0x40;\n\t\t\t\tbyteStream[pos++] = connectFlags;\n\t\t\t\tpos = writeUint16 (this.keepAliveInterval, byteStream, pos);\n\t\t\t}\n\n\t\t\t// Output the messageIdentifier - if there is one\n\t\t\tif (this.messageIdentifier !== undefined)\n\t\t\t\tpos = writeUint16 (this.messageIdentifier, byteStream, pos);\n\n\t\t\tswitch(this.type) {\n\t\t\tcase MESSAGE_TYPE.CONNECT:\n\t\t\t\tpos = writeString(this.clientId, UTF8Length(this.clientId), byteStream, pos);\n\t\t\t\tif (this.willMessage !== undefined) {\n\t\t\t\t\tpos = writeString(this.willMessage.destinationName, UTF8Length(this.willMessage.destinationName), byteStream, pos);\n\t\t\t\t\tpos = writeUint16(willMessagePayloadBytes.byteLength, byteStream, pos);\n\t\t\t\t\tbyteStream.set(willMessagePayloadBytes, pos);\n\t\t\t\t\tpos += willMessagePayloadBytes.byteLength;\n\n\t\t\t\t}\n\t\t\t\tif (this.userName !== undefined)\n\t\t\t\t\tpos = writeString(this.userName, UTF8Length(this.userName), byteStream, pos);\n\t\t\t\tif (this.password !== undefined)\n\t\t\t\t\tpos = writeString(this.password, UTF8Length(this.password), byteStream, pos);\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PUBLISH:\n\t\t\t\t// PUBLISH has a text or binary payload, if text do not add a 2 byte length field, just the UTF characters.\n\t\t\t\tbyteStream.set(payloadBytes, pos);\n\n\t\t\t\tbreak;\n\n\t\t\t\t//    \t    case MESSAGE_TYPE.PUBREC:\n\t\t\t\t//    \t    case MESSAGE_TYPE.PUBREL:\n\t\t\t\t//    \t    case MESSAGE_TYPE.PUBCOMP:\n\t\t\t\t//    \t    \tbreak;\n\n\t\t\tcase MESSAGE_TYPE.SUBSCRIBE:\n\t\t\t\t// SUBSCRIBE has a list of topic strings and request QoS\n\t\t\t\tfor (var i=0; i<this.topics.length; i++) {\n\t\t\t\t\tpos = writeString(this.topics[i], topicStrLength[i], byteStream, pos);\n\t\t\t\t\tbyteStream[pos++] = this.requestedQos[i];\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.UNSUBSCRIBE:\n\t\t\t\t// UNSUBSCRIBE has a list of topic strings\n\t\t\t\tfor (var i=0; i<this.topics.length; i++)\n\t\t\t\t\tpos = writeString(this.topics[i], topicStrLength[i], byteStream, pos);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t// Do nothing.\n\t\t\t}\n\n\t\t\treturn buffer;\n\t\t};\n\n\t\tfunction decodeMessage(input,pos) {\n\t\t\tvar startingPos = pos;\n\t\t\tvar first = input[pos];\n\t\t\tvar type = first >> 4;\n\t\t\tvar messageInfo = first &= 0x0f;\n\t\t\tpos += 1;\n\n\n\t\t\t// Decode the remaining length (MBI format)\n\n\t\t\tvar digit;\n\t\t\tvar remLength = 0;\n\t\t\tvar multiplier = 1;\n\t\t\tdo {\n\t\t\t\tif (pos == input.length) {\n\t\t\t\t\treturn [null,startingPos];\n\t\t\t\t}\n\t\t\t\tdigit = input[pos++];\n\t\t\t\tremLength += ((digit & 0x7F) * multiplier);\n\t\t\t\tmultiplier *= 128;\n\t\t\t} while ((digit & 0x80) !== 0);\n\n\t\t\tvar endPos = pos+remLength;\n\t\t\tif (endPos > input.length) {\n\t\t\t\treturn [null,startingPos];\n\t\t\t}\n\n\t\t\tvar wireMessage = new WireMessage(type);\n\t\t\tswitch(type) {\n\t\t\tcase MESSAGE_TYPE.CONNACK:\n\t\t\t\tvar connectAcknowledgeFlags = input[pos++];\n\t\t\t\tif (connectAcknowledgeFlags & 0x01)\n\t\t\t\t\twireMessage.sessionPresent = true;\n\t\t\t\twireMessage.returnCode = input[pos++];\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PUBLISH:\n\t\t\t\tvar qos = (messageInfo >> 1) & 0x03;\n\n\t\t\t\tvar len = readUint16(input, pos);\n\t\t\t\tpos += 2;\n\t\t\t\tvar topicName = parseUTF8(input, pos, len);\n\t\t\t\tpos += len;\n\t\t\t\t// If QoS 1 or 2 there will be a messageIdentifier\n\t\t\t\tif (qos > 0) {\n\t\t\t\t\twireMessage.messageIdentifier = readUint16(input, pos);\n\t\t\t\t\tpos += 2;\n\t\t\t\t}\n\n\t\t\t\tvar message = new Message(input.subarray(pos, endPos));\n\t\t\t\tif ((messageInfo & 0x01) == 0x01)\n\t\t\t\t\tmessage.retained = true;\n\t\t\t\tif ((messageInfo & 0x08) == 0x08)\n\t\t\t\t\tmessage.duplicate =  true;\n\t\t\t\tmessage.qos = qos;\n\t\t\t\tmessage.destinationName = topicName;\n\t\t\t\twireMessage.payloadMessage = message;\n\t\t\t\tbreak;\n\n\t\t\tcase  MESSAGE_TYPE.PUBACK:\n\t\t\tcase  MESSAGE_TYPE.PUBREC:\n\t\t\tcase  MESSAGE_TYPE.PUBREL:\n\t\t\tcase  MESSAGE_TYPE.PUBCOMP:\n\t\t\tcase  MESSAGE_TYPE.UNSUBACK:\n\t\t\t\twireMessage.messageIdentifier = readUint16(input, pos);\n\t\t\t\tbreak;\n\n\t\t\tcase  MESSAGE_TYPE.SUBACK:\n\t\t\t\twireMessage.messageIdentifier = readUint16(input, pos);\n\t\t\t\tpos += 2;\n\t\t\t\twireMessage.returnCode = input.subarray(pos, endPos);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn [wireMessage,endPos];\n\t\t}\n\n\t\tfunction writeUint16(input, buffer, offset) {\n\t\t\tbuffer[offset++] = input >> 8;      //MSB\n\t\t\tbuffer[offset++] = input % 256;     //LSB\n\t\t\treturn offset;\n\t\t}\n\n\t\tfunction writeString(input, utf8Length, buffer, offset) {\n\t\t\toffset = writeUint16(utf8Length, buffer, offset);\n\t\t\tstringToUTF8(input, buffer, offset);\n\t\t\treturn offset + utf8Length;\n\t\t}\n\n\t\tfunction readUint16(buffer, offset) {\n\t\t\treturn 256*buffer[offset] + buffer[offset+1];\n\t\t}\n\n\t\t/**\n\t * Encodes an MQTT Multi-Byte Integer\n\t * @private\n\t */\n\t\tfunction encodeMBI(number) {\n\t\t\tvar output = new Array(1);\n\t\t\tvar numBytes = 0;\n\n\t\t\tdo {\n\t\t\t\tvar digit = number % 128;\n\t\t\t\tnumber = number >> 7;\n\t\t\t\tif (number > 0) {\n\t\t\t\t\tdigit |= 0x80;\n\t\t\t\t}\n\t\t\t\toutput[numBytes++] = digit;\n\t\t\t} while ( (number > 0) && (numBytes<4) );\n\n\t\t\treturn output;\n\t\t}\n\n\t\t/**\n\t * Takes a String and calculates its length in bytes when encoded in UTF8.\n\t * @private\n\t */\n\t\tfunction UTF8Length(input) {\n\t\t\tvar output = 0;\n\t\t\tfor (var i = 0; i<input.length; i++)\n\t\t\t{\n\t\t\t\tvar charCode = input.charCodeAt(i);\n\t\t\t\tif (charCode > 0x7FF)\n\t\t\t\t{\n\t\t\t\t\t// Surrogate pair means its a 4 byte character\n\t\t\t\t\tif (0xD800 <= charCode && charCode <= 0xDBFF)\n\t\t\t\t\t{\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\toutput++;\n\t\t\t\t\t}\n\t\t\t\t\toutput +=3;\n\t\t\t\t}\n\t\t\t\telse if (charCode > 0x7F)\n\t\t\t\t\toutput +=2;\n\t\t\t\telse\n\t\t\t\t\toutput++;\n\t\t\t}\n\t\t\treturn output;\n\t\t}\n\n\t\t/**\n\t * Takes a String and writes it into an array as UTF8 encoded bytes.\n\t * @private\n\t */\n\t\tfunction stringToUTF8(input, output, start) {\n\t\t\tvar pos = start;\n\t\t\tfor (var i = 0; i<input.length; i++) {\n\t\t\t\tvar charCode = input.charCodeAt(i);\n\n\t\t\t\t// Check for a surrogate pair.\n\t\t\t\tif (0xD800 <= charCode && charCode <= 0xDBFF) {\n\t\t\t\t\tvar lowCharCode = input.charCodeAt(++i);\n\t\t\t\t\tif (isNaN(lowCharCode)) {\n\t\t\t\t\t\tthrow new Error(format(ERROR.MALFORMED_UNICODE, [charCode, lowCharCode]));\n\t\t\t\t\t}\n\t\t\t\t\tcharCode = ((charCode - 0xD800)<<10) + (lowCharCode - 0xDC00) + 0x10000;\n\n\t\t\t\t}\n\n\t\t\t\tif (charCode <= 0x7F) {\n\t\t\t\t\toutput[pos++] = charCode;\n\t\t\t\t} else if (charCode <= 0x7FF) {\n\t\t\t\t\toutput[pos++] = charCode>>6  & 0x1F | 0xC0;\n\t\t\t\t\toutput[pos++] = charCode     & 0x3F | 0x80;\n\t\t\t\t} else if (charCode <= 0xFFFF) {\n\t\t\t\t\toutput[pos++] = charCode>>12 & 0x0F | 0xE0;\n\t\t\t\t\toutput[pos++] = charCode>>6  & 0x3F | 0x80;\n\t\t\t\t\toutput[pos++] = charCode     & 0x3F | 0x80;\n\t\t\t\t} else {\n\t\t\t\t\toutput[pos++] = charCode>>18 & 0x07 | 0xF0;\n\t\t\t\t\toutput[pos++] = charCode>>12 & 0x3F | 0x80;\n\t\t\t\t\toutput[pos++] = charCode>>6  & 0x3F | 0x80;\n\t\t\t\t\toutput[pos++] = charCode     & 0x3F | 0x80;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn output;\n\t\t}\n\n\t\tfunction parseUTF8(input, offset, length) {\n\t\t\tvar output = \"\";\n\t\t\tvar utf16;\n\t\t\tvar pos = offset;\n\n\t\t\twhile (pos < offset+length)\n\t\t\t{\n\t\t\t\tvar byte1 = input[pos++];\n\t\t\t\tif (byte1 < 128)\n\t\t\t\t\tutf16 = byte1;\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvar byte2 = input[pos++]-128;\n\t\t\t\t\tif (byte2 < 0)\n\t\t\t\t\t\tthrow new Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16),\"\"]));\n\t\t\t\t\tif (byte1 < 0xE0)             // 2 byte character\n\t\t\t\t\t\tutf16 = 64*(byte1-0xC0) + byte2;\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar byte3 = input[pos++]-128;\n\t\t\t\t\t\tif (byte3 < 0)\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16), byte3.toString(16)]));\n\t\t\t\t\t\tif (byte1 < 0xF0)        // 3 byte character\n\t\t\t\t\t\t\tutf16 = 4096*(byte1-0xE0) + 64*byte2 + byte3;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar byte4 = input[pos++]-128;\n\t\t\t\t\t\t\tif (byte4 < 0)\n\t\t\t\t\t\t\t\tthrow new Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16), byte3.toString(16), byte4.toString(16)]));\n\t\t\t\t\t\t\tif (byte1 < 0xF8)        // 4 byte character\n\t\t\t\t\t\t\t\tutf16 = 262144*(byte1-0xF0) + 4096*byte2 + 64*byte3 + byte4;\n\t\t\t\t\t\t\telse                     // longer encodings are not supported\n\t\t\t\t\t\t\t\tthrow new Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16), byte3.toString(16), byte4.toString(16)]));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (utf16 > 0xFFFF)   // 4 byte character - express as a surrogate pair\n\t\t\t\t{\n\t\t\t\t\tutf16 -= 0x10000;\n\t\t\t\t\toutput += String.fromCharCode(0xD800 + (utf16 >> 10)); // lead character\n\t\t\t\t\tutf16 = 0xDC00 + (utf16 & 0x3FF);  // trail character\n\t\t\t\t}\n\t\t\t\toutput += String.fromCharCode(utf16);\n\t\t\t}\n\t\t\treturn output;\n\t\t}\n\n\t\t/**\n\t * Repeat keepalive requests, monitor responses.\n\t * @ignore\n\t */\n\t\tvar Pinger = function(client, keepAliveInterval) {\n\t\t\tthis._client = client;\n\t\t\tthis._keepAliveInterval = keepAliveInterval*1000;\n\t\t\tthis.isReset = false;\n\n\t\t\tvar pingReq = new WireMessage(MESSAGE_TYPE.PINGREQ).encode();\n\n\t\t\tvar doTimeout = function (pinger) {\n\t\t\t\treturn function () {\n\t\t\t\t\treturn doPing.apply(pinger);\n\t\t\t\t};\n\t\t\t};\n\n\t\t\t/** @ignore */\n\t\t\tvar doPing = function() {\n\t\t\t\tif (!this.isReset) {\n\t\t\t\t\tthis._client._trace(\"Pinger.doPing\", \"Timed out\");\n\t\t\t\t\tthis._client._disconnected( ERROR.PING_TIMEOUT.code , format(ERROR.PING_TIMEOUT));\n\t\t\t\t} else {\n\t\t\t\t\tthis.isReset = false;\n\t\t\t\t\tthis._client._trace(\"Pinger.doPing\", \"send PINGREQ\");\n\t\t\t\t\tthis._client.socket.send(pingReq);\n\t\t\t\t\tthis.timeout = setTimeout(doTimeout(this), this._keepAliveInterval);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.reset = function() {\n\t\t\t\tthis.isReset = true;\n\t\t\t\tclearTimeout(this.timeout);\n\t\t\t\tif (this._keepAliveInterval > 0)\n\t\t\t\t\tthis.timeout = setTimeout(doTimeout(this), this._keepAliveInterval);\n\t\t\t};\n\n\t\t\tthis.cancel = function() {\n\t\t\t\tclearTimeout(this.timeout);\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t * Monitor request completion.\n\t * @ignore\n\t */\n\t\tvar Timeout = function(client, timeoutSeconds, action, args) {\n\t\t\tif (!timeoutSeconds)\n\t\t\t\ttimeoutSeconds = 30;\n\n\t\t\tvar doTimeout = function (action, client, args) {\n\t\t\t\treturn function () {\n\t\t\t\t\treturn action.apply(client, args);\n\t\t\t\t};\n\t\t\t};\n\t\t\tthis.timeout = setTimeout(doTimeout(action, client, args), timeoutSeconds * 1000);\n\n\t\t\tthis.cancel = function() {\n\t\t\t\tclearTimeout(this.timeout);\n\t\t\t};\n\t\t};\n\n\t/**\n\t * Internal implementation of the Websockets MQTT V3.1 client.\n\t *\n\t * @name Paho.ClientImpl @constructor\n\t * @param {String} host the DNS nameof the webSocket host.\n\t * @param {Number} port the port number for that host.\n\t * @param {String} clientId the MQ client identifier.\n\t */\n\t\tvar ClientImpl = function (uri, host, port, path, clientId) {\n\t\t// Check dependencies are satisfied in this browser.\n\t\t\tif (!(\"WebSocket\" in global && global.WebSocket !== null)) {\n\t\t\t\tthrow new Error(format(ERROR.UNSUPPORTED, [\"WebSocket\"]));\n\t\t\t}\n\t\t\tif (!(\"ArrayBuffer\" in global && global.ArrayBuffer !== null)) {\n\t\t\t\tthrow new Error(format(ERROR.UNSUPPORTED, [\"ArrayBuffer\"]));\n\t\t\t}\n\t\t\tthis._trace(\"Paho.Client\", uri, host, port, path, clientId);\n\n\t\t\tthis.host = host;\n\t\t\tthis.port = port;\n\t\t\tthis.path = path;\n\t\t\tthis.uri = uri;\n\t\t\tthis.clientId = clientId;\n\t\t\tthis._wsuri = null;\n\n\t\t\t// Local storagekeys are qualified with the following string.\n\t\t\t// The conditional inclusion of path in the key is for backward\n\t\t\t// compatibility to when the path was not configurable and assumed to\n\t\t\t// be /mqtt\n\t\t\tthis._localKey=host+\":\"+port+(path!=\"/mqtt\"?\":\"+path:\"\")+\":\"+clientId+\":\";\n\n\t\t\t// Create private instance-only message queue\n\t\t\t// Internal queue of messages to be sent, in sending order.\n\t\t\tthis._msg_queue = [];\n\t\t\tthis._buffered_msg_queue = [];\n\n\t\t\t// Messages we have sent and are expecting a response for, indexed by their respective message ids.\n\t\t\tthis._sentMessages = {};\n\n\t\t\t// Messages we have received and acknowleged and are expecting a confirm message for\n\t\t\t// indexed by their respective message ids.\n\t\t\tthis._receivedMessages = {};\n\n\t\t\t// Internal list of callbacks to be executed when messages\n\t\t\t// have been successfully sent over web socket, e.g. disconnect\n\t\t\t// when it doesn't have to wait for ACK, just message is dispatched.\n\t\t\tthis._notify_msg_sent = {};\n\n\t\t\t// Unique identifier for SEND messages, incrementing\n\t\t\t// counter as messages are sent.\n\t\t\tthis._message_identifier = 1;\n\n\t\t\t// Used to determine the transmission sequence of stored sent messages.\n\t\t\tthis._sequence = 0;\n\n\n\t\t\t// Load the local state, if any, from the saved version, only restore state relevant to this client.\n\t\t\tfor (var key in localStorage)\n\t\t\t\tif (   key.indexOf(\"Sent:\"+this._localKey) === 0 || key.indexOf(\"Received:\"+this._localKey) === 0)\n\t\t\t\t\tthis.restore(key);\n\t\t};\n\n\t\t// Messaging Client public instance members.\n\t\tClientImpl.prototype.host = null;\n\t\tClientImpl.prototype.port = null;\n\t\tClientImpl.prototype.path = null;\n\t\tClientImpl.prototype.uri = null;\n\t\tClientImpl.prototype.clientId = null;\n\n\t\t// Messaging Client private instance members.\n\t\tClientImpl.prototype.socket = null;\n\t\t/* true once we have received an acknowledgement to a CONNECT packet. */\n\t\tClientImpl.prototype.connected = false;\n\t\t/* The largest message identifier allowed, may not be larger than 2**16 but\n\t\t * if set smaller reduces the maximum number of outbound messages allowed.\n\t\t */\n\t\tClientImpl.prototype.maxMessageIdentifier = 65536;\n\t\tClientImpl.prototype.connectOptions = null;\n\t\tClientImpl.prototype.hostIndex = null;\n\t\tClientImpl.prototype.onConnected = null;\n\t\tClientImpl.prototype.onConnectionLost = null;\n\t\tClientImpl.prototype.onMessageDelivered = null;\n\t\tClientImpl.prototype.onMessageArrived = null;\n\t\tClientImpl.prototype.traceFunction = null;\n\t\tClientImpl.prototype._msg_queue = null;\n\t\tClientImpl.prototype._buffered_msg_queue = null;\n\t\tClientImpl.prototype._connectTimeout = null;\n\t\t/* The sendPinger monitors how long we allow before we send data to prove to the server that we are alive. */\n\t\tClientImpl.prototype.sendPinger = null;\n\t\t/* The receivePinger monitors how long we allow before we require evidence that the server is alive. */\n\t\tClientImpl.prototype.receivePinger = null;\n\t\tClientImpl.prototype._reconnectInterval = 1; // Reconnect Delay, starts at 1 second\n\t\tClientImpl.prototype._reconnecting = false;\n\t\tClientImpl.prototype._reconnectTimeout = null;\n\t\tClientImpl.prototype.disconnectedPublishing = false;\n\t\tClientImpl.prototype.disconnectedBufferSize = 5000;\n\n\t\tClientImpl.prototype.receiveBuffer = null;\n\n\t\tClientImpl.prototype._traceBuffer = null;\n\t\tClientImpl.prototype._MAX_TRACE_ENTRIES = 100;\n\n\t\tClientImpl.prototype.connect = function (connectOptions) {\n\t\t\tvar connectOptionsMasked = this._traceMask(connectOptions, \"password\");\n\t\t\tthis._trace(\"Client.connect\", connectOptionsMasked, this.socket, this.connected);\n\n\t\t\tif (this.connected)\n\t\t\t\tthrow new Error(format(ERROR.INVALID_STATE, [\"already connected\"]));\n\t\t\tif (this.socket)\n\t\t\t\tthrow new Error(format(ERROR.INVALID_STATE, [\"already connected\"]));\n\n\t\t\tif (this._reconnecting) {\n\t\t\t// connect() function is called while reconnect is in progress.\n\t\t\t// Terminate the auto reconnect process to use new connect options.\n\t\t\t\tthis._reconnectTimeout.cancel();\n\t\t\t\tthis._reconnectTimeout = null;\n\t\t\t\tthis._reconnecting = false;\n\t\t\t}\n\n\t\t\tthis.connectOptions = connectOptions;\n\t\t\tthis._reconnectInterval = 1;\n\t\t\tthis._reconnecting = false;\n\t\t\tif (connectOptions.uris) {\n\t\t\t\tthis.hostIndex = 0;\n\t\t\t\tthis._doConnect(connectOptions.uris[0]);\n\t\t\t} else {\n\t\t\t\tthis._doConnect(this.uri);\n\t\t\t}\n\n\t\t};\n\n\t\tClientImpl.prototype.subscribe = function (filter, subscribeOptions) {\n\t\t\tthis._trace(\"Client.subscribe\", filter, subscribeOptions);\n\n\t\t\tif (!this.connected)\n\t\t\t\tthrow new Error(format(ERROR.INVALID_STATE, [\"not connected\"]));\n\n            var wireMessage = new WireMessage(MESSAGE_TYPE.SUBSCRIBE);\n            wireMessage.topics = filter.constructor === Array ? filter : [filter];\n            if (subscribeOptions.qos === undefined)\n                subscribeOptions.qos = 0;\n            wireMessage.requestedQos = [];\n            for (var i = 0; i < wireMessage.topics.length; i++)\n                wireMessage.requestedQos[i] = subscribeOptions.qos;\n\n\t\t\tif (subscribeOptions.onSuccess) {\n\t\t\t\twireMessage.onSuccess = function(grantedQos) {subscribeOptions.onSuccess({invocationContext:subscribeOptions.invocationContext,grantedQos:grantedQos});};\n\t\t\t}\n\n\t\t\tif (subscribeOptions.onFailure) {\n\t\t\t\twireMessage.onFailure = function(errorCode) {subscribeOptions.onFailure({invocationContext:subscribeOptions.invocationContext,errorCode:errorCode, errorMessage:format(errorCode)});};\n\t\t\t}\n\n\t\t\tif (subscribeOptions.timeout) {\n\t\t\t\twireMessage.timeOut = new Timeout(this, subscribeOptions.timeout, subscribeOptions.onFailure,\n\t\t\t\t\t[{invocationContext:subscribeOptions.invocationContext,\n\t\t\t\t\t\terrorCode:ERROR.SUBSCRIBE_TIMEOUT.code,\n\t\t\t\t\t\terrorMessage:format(ERROR.SUBSCRIBE_TIMEOUT)}]);\n\t\t\t}\n\n\t\t\t// All subscriptions return a SUBACK.\n\t\t\tthis._requires_ack(wireMessage);\n\t\t\tthis._schedule_message(wireMessage);\n\t\t};\n\n\t\t/** @ignore */\n\t\tClientImpl.prototype.unsubscribe = function(filter, unsubscribeOptions) {\n\t\t\tthis._trace(\"Client.unsubscribe\", filter, unsubscribeOptions);\n\n\t\t\tif (!this.connected)\n\t\t\t\tthrow new Error(format(ERROR.INVALID_STATE, [\"not connected\"]));\n\n            var wireMessage = new WireMessage(MESSAGE_TYPE.UNSUBSCRIBE);\n            wireMessage.topics = filter.constructor === Array ? filter : [filter];\n\n\t\t\tif (unsubscribeOptions.onSuccess) {\n\t\t\t\twireMessage.callback = function() {unsubscribeOptions.onSuccess({invocationContext:unsubscribeOptions.invocationContext});};\n\t\t\t}\n\t\t\tif (unsubscribeOptions.timeout) {\n\t\t\t\twireMessage.timeOut = new Timeout(this, unsubscribeOptions.timeout, unsubscribeOptions.onFailure,\n\t\t\t\t\t[{invocationContext:unsubscribeOptions.invocationContext,\n\t\t\t\t\t\terrorCode:ERROR.UNSUBSCRIBE_TIMEOUT.code,\n\t\t\t\t\t\terrorMessage:format(ERROR.UNSUBSCRIBE_TIMEOUT)}]);\n\t\t\t}\n\n\t\t\t// All unsubscribes return a SUBACK.\n\t\t\tthis._requires_ack(wireMessage);\n\t\t\tthis._schedule_message(wireMessage);\n\t\t};\n\n\t\tClientImpl.prototype.send = function (message) {\n\t\t\tthis._trace(\"Client.send\", message);\n\n\t\t\tvar wireMessage = new WireMessage(MESSAGE_TYPE.PUBLISH);\n\t\t\twireMessage.payloadMessage = message;\n\n\t\t\tif (this.connected) {\n\t\t\t// Mark qos 1 & 2 message as \"ACK required\"\n\t\t\t// For qos 0 message, invoke onMessageDelivered callback if there is one.\n\t\t\t// Then schedule the message.\n\t\t\t\tif (message.qos > 0) {\n\t\t\t\t\tthis._requires_ack(wireMessage);\n\t\t\t\t} else if (this.onMessageDelivered) {\n\t\t\t\t\tthis._notify_msg_sent[wireMessage] = this.onMessageDelivered(wireMessage.payloadMessage);\n\t\t\t\t}\n\t\t\t\tthis._schedule_message(wireMessage);\n\t\t\t} else {\n\t\t\t// Currently disconnected, will not schedule this message\n\t\t\t// Check if reconnecting is in progress and disconnected publish is enabled.\n\t\t\t\tif (this._reconnecting && this.disconnectedPublishing) {\n\t\t\t\t// Check the limit which include the \"required ACK\" messages\n\t\t\t\t\tvar messageCount = Object.keys(this._sentMessages).length + this._buffered_msg_queue.length;\n\t\t\t\t\tif (messageCount > this.disconnectedBufferSize) {\n\t\t\t\t\t\tthrow new Error(format(ERROR.BUFFER_FULL, [this.disconnectedBufferSize]));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (message.qos > 0) {\n\t\t\t\t\t\t// Mark this message as \"ACK required\"\n\t\t\t\t\t\t\tthis._requires_ack(wireMessage);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twireMessage.sequence = ++this._sequence;\n\t\t\t\t\t\t\t// Add messages in fifo order to array, by adding to start\n\t\t\t\t\t\t\tthis._buffered_msg_queue.unshift(wireMessage);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(format(ERROR.INVALID_STATE, [\"not connected\"]));\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tClientImpl.prototype.disconnect = function () {\n\t\t\tthis._trace(\"Client.disconnect\");\n\n\t\t\tif (this._reconnecting) {\n\t\t\t// disconnect() function is called while reconnect is in progress.\n\t\t\t// Terminate the auto reconnect process.\n\t\t\t\tthis._reconnectTimeout.cancel();\n\t\t\t\tthis._reconnectTimeout = null;\n\t\t\t\tthis._reconnecting = false;\n\t\t\t}\n\n\t\t\tif (!this.socket)\n\t\t\t\tthrow new Error(format(ERROR.INVALID_STATE, [\"not connecting or connected\"]));\n\n\t\t\tvar wireMessage = new WireMessage(MESSAGE_TYPE.DISCONNECT);\n\n\t\t\t// Run the disconnected call back as soon as the message has been sent,\n\t\t\t// in case of a failure later on in the disconnect processing.\n\t\t\t// as a consequence, the _disconected call back may be run several times.\n\t\t\tthis._notify_msg_sent[wireMessage] = scope(this._disconnected, this);\n\n\t\t\tthis._schedule_message(wireMessage);\n\t\t};\n\n\t\tClientImpl.prototype.getTraceLog = function () {\n\t\t\tif ( this._traceBuffer !== null ) {\n\t\t\t\tthis._trace(\"Client.getTraceLog\", new Date());\n\t\t\t\tthis._trace(\"Client.getTraceLog in flight messages\", this._sentMessages.length);\n\t\t\t\tfor (var key in this._sentMessages)\n\t\t\t\t\tthis._trace(\"_sentMessages \",key, this._sentMessages[key]);\n\t\t\t\tfor (var key in this._receivedMessages)\n\t\t\t\t\tthis._trace(\"_receivedMessages \",key, this._receivedMessages[key]);\n\n\t\t\t\treturn this._traceBuffer;\n\t\t\t}\n\t\t};\n\n\t\tClientImpl.prototype.startTrace = function () {\n\t\t\tif ( this._traceBuffer === null ) {\n\t\t\t\tthis._traceBuffer = [];\n\t\t\t}\n\t\t\tthis._trace(\"Client.startTrace\", new Date(), version);\n\t\t};\n\n\t\tClientImpl.prototype.stopTrace = function () {\n\t\t\tdelete this._traceBuffer;\n\t\t};\n\n\t\tClientImpl.prototype._doConnect = function (wsurl) {\n\t\t// When the socket is open, this client will send the CONNECT WireMessage using the saved parameters.\n\t\t\tif (this.connectOptions.useSSL) {\n\t\t\t\tvar uriParts = wsurl.split(\":\");\n\t\t\t\turiParts[0] = \"wss\";\n\t\t\t\twsurl = uriParts.join(\":\");\n\t\t\t}\n\t\t\tthis._wsuri = wsurl;\n\t\t\tthis.connected = false;\n\n\n\n\t\t\tif (this.connectOptions.mqttVersion < 4) {\n\t\t\t\tthis.socket = new WebSocket(wsurl, [\"mqttv3.1\"]);\n\t\t\t} else {\n\t\t\t\tthis.socket = new WebSocket(wsurl, [\"mqtt\"]);\n\t\t\t}\n\t\t\tthis.socket.binaryType = \"arraybuffer\";\n\t\t\tthis.socket.onopen = scope(this._on_socket_open, this);\n\t\t\tthis.socket.onmessage = scope(this._on_socket_message, this);\n\t\t\tthis.socket.onerror = scope(this._on_socket_error, this);\n\t\t\tthis.socket.onclose = scope(this._on_socket_close, this);\n\n\t\t\tthis.sendPinger = new Pinger(this, this.connectOptions.keepAliveInterval);\n\t\t\tthis.receivePinger = new Pinger(this, this.connectOptions.keepAliveInterval);\n\t\t\tif (this._connectTimeout) {\n\t\t\t\tthis._connectTimeout.cancel();\n\t\t\t\tthis._connectTimeout = null;\n\t\t\t}\n\t\t\tthis._connectTimeout = new Timeout(this, this.connectOptions.timeout, this._disconnected,  [ERROR.CONNECT_TIMEOUT.code, format(ERROR.CONNECT_TIMEOUT)]);\n\t\t};\n\n\n\t\t// Schedule a new message to be sent over the WebSockets\n\t\t// connection. CONNECT messages cause WebSocket connection\n\t\t// to be started. All other messages are queued internally\n\t\t// until this has happened. When WS connection starts, process\n\t\t// all outstanding messages.\n\t\tClientImpl.prototype._schedule_message = function (message) {\n\t\t\t// Add messages in fifo order to array, by adding to start\n\t\t\tthis._msg_queue.unshift(message);\n\t\t\t// Process outstanding messages in the queue if we have an  open socket, and have received CONNACK.\n\t\t\tif (this.connected) {\n\t\t\t\tthis._process_queue();\n\t\t\t}\n\t\t};\n\n\t\tClientImpl.prototype.store = function(prefix, wireMessage) {\n\t\t\tvar storedMessage = {type:wireMessage.type, messageIdentifier:wireMessage.messageIdentifier, version:1};\n\n\t\t\tswitch(wireMessage.type) {\n\t\t\tcase MESSAGE_TYPE.PUBLISH:\n\t\t\t\tif(wireMessage.pubRecReceived)\n\t\t\t\t\tstoredMessage.pubRecReceived = true;\n\n\t\t\t\t// Convert the payload to a hex string.\n\t\t\t\tstoredMessage.payloadMessage = {};\n\t\t\t\tvar hex = \"\";\n\t\t\t\tvar messageBytes = wireMessage.payloadMessage.payloadBytes;\n\t\t\t\tfor (var i=0; i<messageBytes.length; i++) {\n\t\t\t\t\tif (messageBytes[i] <= 0xF)\n\t\t\t\t\t\thex = hex+\"0\"+messageBytes[i].toString(16);\n\t\t\t\t\telse\n\t\t\t\t\t\thex = hex+messageBytes[i].toString(16);\n\t\t\t\t}\n\t\t\t\tstoredMessage.payloadMessage.payloadHex = hex;\n\n\t\t\t\tstoredMessage.payloadMessage.qos = wireMessage.payloadMessage.qos;\n\t\t\t\tstoredMessage.payloadMessage.destinationName = wireMessage.payloadMessage.destinationName;\n\t\t\t\tif (wireMessage.payloadMessage.duplicate)\n\t\t\t\t\tstoredMessage.payloadMessage.duplicate = true;\n\t\t\t\tif (wireMessage.payloadMessage.retained)\n\t\t\t\t\tstoredMessage.payloadMessage.retained = true;\n\n\t\t\t\t// Add a sequence number to sent messages.\n\t\t\t\tif ( prefix.indexOf(\"Sent:\") === 0 ) {\n\t\t\t\t\tif ( wireMessage.sequence === undefined )\n\t\t\t\t\t\twireMessage.sequence = ++this._sequence;\n\t\t\t\t\tstoredMessage.sequence = wireMessage.sequence;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow Error(format(ERROR.INVALID_STORED_DATA, [prefix+this._localKey+wireMessage.messageIdentifier, storedMessage]));\n\t\t\t}\n\t\t\tlocalStorage.setItem(prefix+this._localKey+wireMessage.messageIdentifier, JSON.stringify(storedMessage));\n\t\t};\n\n\t\tClientImpl.prototype.restore = function(key) {\n\t\t\tvar value = localStorage.getItem(key);\n\t\t\tvar storedMessage = JSON.parse(value);\n\n\t\t\tvar wireMessage = new WireMessage(storedMessage.type, storedMessage);\n\n\t\t\tswitch(storedMessage.type) {\n\t\t\tcase MESSAGE_TYPE.PUBLISH:\n\t\t\t\t// Replace the payload message with a Message object.\n\t\t\t\tvar hex = storedMessage.payloadMessage.payloadHex;\n\t\t\t\tvar buffer = new ArrayBuffer((hex.length)/2);\n\t\t\t\tvar byteStream = new Uint8Array(buffer);\n\t\t\t\tvar i = 0;\n\t\t\t\twhile (hex.length >= 2) {\n\t\t\t\t\tvar x = parseInt(hex.substring(0, 2), 16);\n\t\t\t\t\thex = hex.substring(2, hex.length);\n\t\t\t\t\tbyteStream[i++] = x;\n\t\t\t\t}\n\t\t\t\tvar payloadMessage = new Message(byteStream);\n\n\t\t\t\tpayloadMessage.qos = storedMessage.payloadMessage.qos;\n\t\t\t\tpayloadMessage.destinationName = storedMessage.payloadMessage.destinationName;\n\t\t\t\tif (storedMessage.payloadMessage.duplicate)\n\t\t\t\t\tpayloadMessage.duplicate = true;\n\t\t\t\tif (storedMessage.payloadMessage.retained)\n\t\t\t\t\tpayloadMessage.retained = true;\n\t\t\t\twireMessage.payloadMessage = payloadMessage;\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow Error(format(ERROR.INVALID_STORED_DATA, [key, value]));\n\t\t\t}\n\n\t\t\tif (key.indexOf(\"Sent:\"+this._localKey) === 0) {\n\t\t\t\twireMessage.payloadMessage.duplicate = true;\n\t\t\t\tthis._sentMessages[wireMessage.messageIdentifier] = wireMessage;\n\t\t\t} else if (key.indexOf(\"Received:\"+this._localKey) === 0) {\n\t\t\t\tthis._receivedMessages[wireMessage.messageIdentifier] = wireMessage;\n\t\t\t}\n\t\t};\n\n\t\tClientImpl.prototype._process_queue = function () {\n\t\t\tvar message = null;\n\n\t\t\t// Send all queued messages down socket connection\n\t\t\twhile ((message = this._msg_queue.pop())) {\n\t\t\t\tthis._socket_send(message);\n\t\t\t\t// Notify listeners that message was successfully sent\n\t\t\t\tif (this._notify_msg_sent[message]) {\n\t\t\t\t\tthis._notify_msg_sent[message]();\n\t\t\t\t\tdelete this._notify_msg_sent[message];\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t * Expect an ACK response for this message. Add message to the set of in progress\n\t * messages and set an unused identifier in this message.\n\t * @ignore\n\t */\n\t\tClientImpl.prototype._requires_ack = function (wireMessage) {\n\t\t\tvar messageCount = Object.keys(this._sentMessages).length;\n\t\t\tif (messageCount > this.maxMessageIdentifier)\n\t\t\t\tthrow Error (\"Too many messages:\"+messageCount);\n\n\t\t\twhile(this._sentMessages[this._message_identifier] !== undefined) {\n\t\t\t\tthis._message_identifier++;\n\t\t\t}\n\t\t\twireMessage.messageIdentifier = this._message_identifier;\n\t\t\tthis._sentMessages[wireMessage.messageIdentifier] = wireMessage;\n\t\t\tif (wireMessage.type === MESSAGE_TYPE.PUBLISH) {\n\t\t\t\tthis.store(\"Sent:\", wireMessage);\n\t\t\t}\n\t\t\tif (this._message_identifier === this.maxMessageIdentifier) {\n\t\t\t\tthis._message_identifier = 1;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t * Called when the underlying websocket has been opened.\n\t * @ignore\n\t */\n\t\tClientImpl.prototype._on_socket_open = function () {\n\t\t// Create the CONNECT message object.\n\t\t\tvar wireMessage = new WireMessage(MESSAGE_TYPE.CONNECT, this.connectOptions);\n\t\t\twireMessage.clientId = this.clientId;\n\t\t\tthis._socket_send(wireMessage);\n\t\t};\n\n\t\t/**\n\t * Called when the underlying websocket has received a complete packet.\n\t * @ignore\n\t */\n\t\tClientImpl.prototype._on_socket_message = function (event) {\n\t\t\tthis._trace(\"Client._on_socket_message\", event.data);\n\t\t\tvar messages = this._deframeMessages(event.data);\n\t\t\tfor (var i = 0; i < messages.length; i+=1) {\n\t\t\t\tthis._handleMessage(messages[i]);\n\t\t\t}\n\t\t};\n\n\t\tClientImpl.prototype._deframeMessages = function(data) {\n\t\t\tvar byteArray = new Uint8Array(data);\n\t\t\tvar messages = [];\n\t\t\tif (this.receiveBuffer) {\n\t\t\t\tvar newData = new Uint8Array(this.receiveBuffer.length+byteArray.length);\n\t\t\t\tnewData.set(this.receiveBuffer);\n\t\t\t\tnewData.set(byteArray,this.receiveBuffer.length);\n\t\t\t\tbyteArray = newData;\n\t\t\t\tdelete this.receiveBuffer;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tvar offset = 0;\n\t\t\t\twhile(offset < byteArray.length) {\n\t\t\t\t\tvar result = decodeMessage(byteArray,offset);\n\t\t\t\t\tvar wireMessage = result[0];\n\t\t\t\t\toffset = result[1];\n\t\t\t\t\tif (wireMessage !== null) {\n\t\t\t\t\t\tmessages.push(wireMessage);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (offset < byteArray.length) {\n\t\t\t\t\tthis.receiveBuffer = byteArray.subarray(offset);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tvar errorStack = ((error.hasOwnProperty(\"stack\") == \"undefined\") ? error.stack.toString() : \"No Error Stack Available\");\n\t\t\t\tthis._disconnected(ERROR.INTERNAL_ERROR.code , format(ERROR.INTERNAL_ERROR, [error.message,errorStack]));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn messages;\n\t\t};\n\n\t\tClientImpl.prototype._handleMessage = function(wireMessage) {\n\n\t\t\tthis._trace(\"Client._handleMessage\", wireMessage);\n\n\t\t\ttry {\n\t\t\t\tswitch(wireMessage.type) {\n\t\t\t\tcase MESSAGE_TYPE.CONNACK:\n\t\t\t\t\tthis._connectTimeout.cancel();\n\t\t\t\t\tif (this._reconnectTimeout)\n\t\t\t\t\t\tthis._reconnectTimeout.cancel();\n\n\t\t\t\t\t// If we have started using clean session then clear up the local state.\n\t\t\t\t\tif (this.connectOptions.cleanSession) {\n\t\t\t\t\t\tfor (var key in this._sentMessages) {\n\t\t\t\t\t\t\tvar sentMessage = this._sentMessages[key];\n\t\t\t\t\t\t\tlocalStorage.removeItem(\"Sent:\"+this._localKey+sentMessage.messageIdentifier);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._sentMessages = {};\n\n\t\t\t\t\t\tfor (var key in this._receivedMessages) {\n\t\t\t\t\t\t\tvar receivedMessage = this._receivedMessages[key];\n\t\t\t\t\t\t\tlocalStorage.removeItem(\"Received:\"+this._localKey+receivedMessage.messageIdentifier);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._receivedMessages = {};\n\t\t\t\t\t}\n\t\t\t\t\t// Client connected and ready for business.\n\t\t\t\t\tif (wireMessage.returnCode === 0) {\n\n\t\t\t\t\t\tthis.connected = true;\n\t\t\t\t\t\t// Jump to the end of the list of uris and stop looking for a good host.\n\n\t\t\t\t\t\tif (this.connectOptions.uris)\n\t\t\t\t\t\t\tthis.hostIndex = this.connectOptions.uris.length;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._disconnected(ERROR.CONNACK_RETURNCODE.code , format(ERROR.CONNACK_RETURNCODE, [wireMessage.returnCode, CONNACK_RC[wireMessage.returnCode]]));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Resend messages.\n\t\t\t\t\tvar sequencedMessages = [];\n\t\t\t\t\tfor (var msgId in this._sentMessages) {\n\t\t\t\t\t\tif (this._sentMessages.hasOwnProperty(msgId))\n\t\t\t\t\t\t\tsequencedMessages.push(this._sentMessages[msgId]);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Also schedule qos 0 buffered messages if any\n\t\t\t\t\tif (this._buffered_msg_queue.length > 0) {\n\t\t\t\t\t\tvar msg = null;\n\t\t\t\t\t\twhile ((msg = this._buffered_msg_queue.pop())) {\n\t\t\t\t\t\t\tsequencedMessages.push(msg);\n\t\t\t\t\t\t\tif (this.onMessageDelivered)\n\t\t\t\t\t\t\t\tthis._notify_msg_sent[msg] = this.onMessageDelivered(msg.payloadMessage);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Sort sentMessages into the original sent order.\n\t\t\t\t\tvar sequencedMessages = sequencedMessages.sort(function(a,b) {return a.sequence - b.sequence;} );\n\t\t\t\t\tfor (var i=0, len=sequencedMessages.length; i<len; i++) {\n\t\t\t\t\t\tvar sentMessage = sequencedMessages[i];\n\t\t\t\t\t\tif (sentMessage.type == MESSAGE_TYPE.PUBLISH && sentMessage.pubRecReceived) {\n\t\t\t\t\t\t\tvar pubRelMessage = new WireMessage(MESSAGE_TYPE.PUBREL, {messageIdentifier:sentMessage.messageIdentifier});\n\t\t\t\t\t\t\tthis._schedule_message(pubRelMessage);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._schedule_message(sentMessage);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Execute the connectOptions.onSuccess callback if there is one.\n\t\t\t\t\t// Will also now return if this connection was the result of an automatic\n\t\t\t\t\t// reconnect and which URI was successfully connected to.\n\t\t\t\t\tif (this.connectOptions.onSuccess) {\n\t\t\t\t\t\tthis.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext});\n\t\t\t\t\t}\n\n\t\t\t\t\tvar reconnected = false;\n\t\t\t\t\tif (this._reconnecting) {\n\t\t\t\t\t\treconnected = true;\n\t\t\t\t\t\tthis._reconnectInterval = 1;\n\t\t\t\t\t\tthis._reconnecting = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Execute the onConnected callback if there is one.\n\t\t\t\t\tthis._connected(reconnected, this._wsuri);\n\n\t\t\t\t\t// Process all queued messages now that the connection is established.\n\t\t\t\t\tthis._process_queue();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MESSAGE_TYPE.PUBLISH:\n\t\t\t\t\tthis._receivePublish(wireMessage);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MESSAGE_TYPE.PUBACK:\n\t\t\t\t\tvar sentMessage = this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t\t// If this is a re flow of a PUBACK after we have restarted receivedMessage will not exist.\n\t\t\t\t\tif (sentMessage) {\n\t\t\t\t\t\tdelete this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t\t\tlocalStorage.removeItem(\"Sent:\"+this._localKey+wireMessage.messageIdentifier);\n\t\t\t\t\t\tif (this.onMessageDelivered)\n\t\t\t\t\t\t\tthis.onMessageDelivered(sentMessage.payloadMessage);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MESSAGE_TYPE.PUBREC:\n\t\t\t\t\tvar sentMessage = this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t\t// If this is a re flow of a PUBREC after we have restarted receivedMessage will not exist.\n\t\t\t\t\tif (sentMessage) {\n\t\t\t\t\t\tsentMessage.pubRecReceived = true;\n\t\t\t\t\t\tvar pubRelMessage = new WireMessage(MESSAGE_TYPE.PUBREL, {messageIdentifier:wireMessage.messageIdentifier});\n\t\t\t\t\t\tthis.store(\"Sent:\", sentMessage);\n\t\t\t\t\t\tthis._schedule_message(pubRelMessage);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MESSAGE_TYPE.PUBREL:\n\t\t\t\t\tvar receivedMessage = this._receivedMessages[wireMessage.messageIdentifier];\n\t\t\t\t\tlocalStorage.removeItem(\"Received:\"+this._localKey+wireMessage.messageIdentifier);\n\t\t\t\t\t// If this is a re flow of a PUBREL after we have restarted receivedMessage will not exist.\n\t\t\t\t\tif (receivedMessage) {\n\t\t\t\t\t\tthis._receiveMessage(receivedMessage);\n\t\t\t\t\t\tdelete this._receivedMessages[wireMessage.messageIdentifier];\n\t\t\t\t\t}\n\t\t\t\t\t// Always flow PubComp, we may have previously flowed PubComp but the server lost it and restarted.\n\t\t\t\t\tvar pubCompMessage = new WireMessage(MESSAGE_TYPE.PUBCOMP, {messageIdentifier:wireMessage.messageIdentifier});\n\t\t\t\t\tthis._schedule_message(pubCompMessage);\n\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MESSAGE_TYPE.PUBCOMP:\n\t\t\t\t\tvar sentMessage = this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t\tdelete this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t\tlocalStorage.removeItem(\"Sent:\"+this._localKey+wireMessage.messageIdentifier);\n\t\t\t\t\tif (this.onMessageDelivered)\n\t\t\t\t\t\tthis.onMessageDelivered(sentMessage.payloadMessage);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MESSAGE_TYPE.SUBACK:\n\t\t\t\t\tvar sentMessage = this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t\tif (sentMessage) {\n\t\t\t\t\t\tif(sentMessage.timeOut)\n\t\t\t\t\t\t\tsentMessage.timeOut.cancel();\n\t\t\t\t\t\t// This will need to be fixed when we add multiple topic support\n\t\t\t\t\t\tif (wireMessage.returnCode[0] === 0x80) {\n\t\t\t\t\t\t\tif (sentMessage.onFailure) {\n\t\t\t\t\t\t\t\tsentMessage.onFailure(wireMessage.returnCode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (sentMessage.onSuccess) {\n\t\t\t\t\t\t\tsentMessage.onSuccess(wireMessage.returnCode);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdelete this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MESSAGE_TYPE.UNSUBACK:\n\t\t\t\t\tvar sentMessage = this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t\tif (sentMessage) {\n\t\t\t\t\t\tif (sentMessage.timeOut)\n\t\t\t\t\t\t\tsentMessage.timeOut.cancel();\n\t\t\t\t\t\tif (sentMessage.callback) {\n\t\t\t\t\t\t\tsentMessage.callback();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdelete this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MESSAGE_TYPE.PINGRESP:\n\t\t\t\t/* The sendPinger or receivePinger may have sent a ping, the receivePinger has already been reset. */\n\t\t\t\t\tthis.sendPinger.reset();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MESSAGE_TYPE.DISCONNECT:\n\t\t\t\t// Clients do not expect to receive disconnect packets.\n\t\t\t\t\tthis._disconnected(ERROR.INVALID_MQTT_MESSAGE_TYPE.code , format(ERROR.INVALID_MQTT_MESSAGE_TYPE, [wireMessage.type]));\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthis._disconnected(ERROR.INVALID_MQTT_MESSAGE_TYPE.code , format(ERROR.INVALID_MQTT_MESSAGE_TYPE, [wireMessage.type]));\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tvar errorStack = ((error.hasOwnProperty(\"stack\") == \"undefined\") ? error.stack.toString() : \"No Error Stack Available\");\n\t\t\t\tthis._disconnected(ERROR.INTERNAL_ERROR.code , format(ERROR.INTERNAL_ERROR, [error.message,errorStack]));\n\t\t\t\treturn;\n\t\t\t}\n\t\t};\n\n\t\t/** @ignore */\n\t\tClientImpl.prototype._on_socket_error = function (error) {\n\t\t\tif (!this._reconnecting) {\n\t\t\t\tthis._disconnected(ERROR.SOCKET_ERROR.code , format(ERROR.SOCKET_ERROR, [error.data]));\n\t\t\t}\n\t\t};\n\n\t\t/** @ignore */\n\t\tClientImpl.prototype._on_socket_close = function () {\n\t\t\tif (!this._reconnecting) {\n\t\t\t\tthis._disconnected(ERROR.SOCKET_CLOSE.code , format(ERROR.SOCKET_CLOSE));\n\t\t\t}\n\t\t};\n\n\t\t/** @ignore */\n\t\tClientImpl.prototype._socket_send = function (wireMessage) {\n\n\t\t\tif (wireMessage.type == 1) {\n\t\t\t\tvar wireMessageMasked = this._traceMask(wireMessage, \"password\");\n\t\t\t\tthis._trace(\"Client._socket_send\", wireMessageMasked);\n\t\t\t}\n\t\t\telse this._trace(\"Client._socket_send\", wireMessage);\n\n\t\t\tthis.socket.send(wireMessage.encode());\n\t\t\t/* We have proved to the server we are alive. */\n\t\t\tthis.sendPinger.reset();\n\t\t};\n\n\t\t/** @ignore */\n\t\tClientImpl.prototype._receivePublish = function (wireMessage) {\n\t\t\tswitch(wireMessage.payloadMessage.qos) {\n\t\t\tcase \"undefined\":\n\t\t\tcase 0:\n\t\t\t\tthis._receiveMessage(wireMessage);\n\t\t\t\tbreak;\n\n\t\t\tcase 1:\n\t\t\t\tvar pubAckMessage = new WireMessage(MESSAGE_TYPE.PUBACK, {messageIdentifier:wireMessage.messageIdentifier});\n\t\t\t\tthis._schedule_message(pubAckMessage);\n\t\t\t\tthis._receiveMessage(wireMessage);\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\t\t\t\tthis._receivedMessages[wireMessage.messageIdentifier] = wireMessage;\n\t\t\t\tthis.store(\"Received:\", wireMessage);\n\t\t\t\tvar pubRecMessage = new WireMessage(MESSAGE_TYPE.PUBREC, {messageIdentifier:wireMessage.messageIdentifier});\n\t\t\t\tthis._schedule_message(pubRecMessage);\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow Error(\"Invaild qos=\" + wireMessage.payloadMessage.qos);\n\t\t\t}\n\t\t};\n\n\t\t/** @ignore */\n\t\tClientImpl.prototype._receiveMessage = function (wireMessage) {\n\t\t\tif (this.onMessageArrived) {\n\t\t\t\tthis.onMessageArrived(wireMessage.payloadMessage);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t * Client has connected.\n\t * @param {reconnect} [boolean] indicate if this was a result of reconnect operation.\n\t * @param {uri} [string] fully qualified WebSocket URI of the server.\n\t */\n\t\tClientImpl.prototype._connected = function (reconnect, uri) {\n\t\t// Execute the onConnected callback if there is one.\n\t\t\tif (this.onConnected)\n\t\t\t\tthis.onConnected(reconnect, uri);\n\t\t};\n\n\t\t/**\n\t * Attempts to reconnect the client to the server.\n   * For each reconnect attempt, will double the reconnect interval\n   * up to 128 seconds.\n\t */\n\t\tClientImpl.prototype._reconnect = function () {\n\t\t\tthis._trace(\"Client._reconnect\");\n\t\t\tif (!this.connected) {\n\t\t\t\tthis._reconnecting = true;\n\t\t\t\tthis.sendPinger.cancel();\n\t\t\t\tthis.receivePinger.cancel();\n\t\t\t\tif (this._reconnectInterval < 128)\n\t\t\t\t\tthis._reconnectInterval = this._reconnectInterval * 2;\n\t\t\t\tif (this.connectOptions.uris) {\n\t\t\t\t\tthis.hostIndex = 0;\n\t\t\t\t\tthis._doConnect(this.connectOptions.uris[0]);\n\t\t\t\t} else {\n\t\t\t\t\tthis._doConnect(this.uri);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t * Client has disconnected either at its own request or because the server\n\t * or network disconnected it. Remove all non-durable state.\n\t * @param {errorCode} [number] the error number.\n\t * @param {errorText} [string] the error text.\n\t * @ignore\n\t */\n\t\tClientImpl.prototype._disconnected = function (errorCode, errorText) {\n\t\t\tthis._trace(\"Client._disconnected\", errorCode, errorText);\n\n\t\t\tif (errorCode !== undefined && this._reconnecting) {\n\t\t\t\t//Continue automatic reconnect process\n\t\t\t\tthis._reconnectTimeout = new Timeout(this, this._reconnectInterval, this._reconnect);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.sendPinger.cancel();\n\t\t\tthis.receivePinger.cancel();\n\t\t\tif (this._connectTimeout) {\n\t\t\t\tthis._connectTimeout.cancel();\n\t\t\t\tthis._connectTimeout = null;\n\t\t\t}\n\n\t\t\t// Clear message buffers.\n\t\t\tthis._msg_queue = [];\n\t\t\tthis._buffered_msg_queue = [];\n\t\t\tthis._notify_msg_sent = {};\n\n\t\t\tif (this.socket) {\n\t\t\t// Cancel all socket callbacks so that they cannot be driven again by this socket.\n\t\t\t\tthis.socket.onopen = null;\n\t\t\t\tthis.socket.onmessage = null;\n\t\t\t\tthis.socket.onerror = null;\n\t\t\t\tthis.socket.onclose = null;\n\t\t\t\tif (this.socket.readyState === 1)\n\t\t\t\t\tthis.socket.close();\n\t\t\t\tdelete this.socket;\n\t\t\t}\n\n\t\t\tif (this.connectOptions.uris && this.hostIndex < this.connectOptions.uris.length-1) {\n\t\t\t// Try the next host.\n\t\t\t\tthis.hostIndex++;\n\t\t\t\tthis._doConnect(this.connectOptions.uris[this.hostIndex]);\n\t\t\t} else {\n\n\t\t\t\tif (errorCode === undefined) {\n\t\t\t\t\terrorCode = ERROR.OK.code;\n\t\t\t\t\terrorText = format(ERROR.OK);\n\t\t\t\t}\n\n\t\t\t\t// Run any application callbacks last as they may attempt to reconnect and hence create a new socket.\n\t\t\t\tif (this.connected) {\n\t\t\t\t\tthis.connected = false;\n\t\t\t\t\t// Execute the connectionLostCallback if there is one, and we were connected.\n\t\t\t\t\tif (this.onConnectionLost) {\n\t\t\t\t\t\tthis.onConnectionLost({errorCode:errorCode, errorMessage:errorText, reconnect:this.connectOptions.reconnect, uri:this._wsuri});\n\t\t\t\t\t}\n\t\t\t\t\tif (errorCode !== ERROR.OK.code && this.connectOptions.reconnect) {\n\t\t\t\t\t// Start automatic reconnect process for the very first time since last successful connect.\n\t\t\t\t\t\tthis._reconnectInterval = 1;\n\t\t\t\t\t\tthis._reconnect();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t// Otherwise we never had a connection, so indicate that the connect has failed.\n\t\t\t\t\tif (this.connectOptions.mqttVersion === 4 && this.connectOptions.mqttVersionExplicit === false) {\n\t\t\t\t\t\tthis._trace(\"Failed to connect V4, dropping back to V3\");\n\t\t\t\t\t\tthis.connectOptions.mqttVersion = 3;\n\t\t\t\t\t\tif (this.connectOptions.uris) {\n\t\t\t\t\t\t\tthis.hostIndex = 0;\n\t\t\t\t\t\t\tthis._doConnect(this.connectOptions.uris[0]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._doConnect(this.uri);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if(this.connectOptions.onFailure) {\n\t\t\t\t\t\tthis.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext, errorCode:errorCode, errorMessage:errorText});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/** @ignore */\n\t\tClientImpl.prototype._trace = function () {\n\t\t// Pass trace message back to client's callback function\n\t\t\tif (this.traceFunction) {\n\t\t\t\tvar args = Array.prototype.slice.call(arguments);\n\t\t\t\tfor (var i in args)\n\t\t\t\t{\n\t\t\t\t\tif (typeof args[i] !== \"undefined\")\n\t\t\t\t\t\targs.splice(i, 1, JSON.stringify(args[i]));\n\t\t\t\t}\n\t\t\t\tvar record = args.join(\"\");\n\t\t\t\tthis.traceFunction ({severity: \"Debug\", message: record\t});\n\t\t\t}\n\n\t\t\t//buffer style trace\n\t\t\tif ( this._traceBuffer !== null ) {\n\t\t\t\tfor (var i = 0, max = arguments.length; i < max; i++) {\n\t\t\t\t\tif ( this._traceBuffer.length == this._MAX_TRACE_ENTRIES ) {\n\t\t\t\t\t\tthis._traceBuffer.shift();\n\t\t\t\t\t}\n\t\t\t\t\tif (i === 0) this._traceBuffer.push(arguments[i]);\n\t\t\t\t\telse if (typeof arguments[i] === \"undefined\" ) this._traceBuffer.push(arguments[i]);\n\t\t\t\t\telse this._traceBuffer.push(\"  \"+JSON.stringify(arguments[i]));\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/** @ignore */\n\t\tClientImpl.prototype._traceMask = function (traceObject, masked) {\n\t\t\tvar traceObjectMasked = {};\n\t\t\tfor (var attr in traceObject) {\n\t\t\t\tif (traceObject.hasOwnProperty(attr)) {\n\t\t\t\t\tif (attr == masked)\n\t\t\t\t\t\ttraceObjectMasked[attr] = \"******\";\n\t\t\t\t\telse\n\t\t\t\t\t\ttraceObjectMasked[attr] = traceObject[attr];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn traceObjectMasked;\n\t\t};\n\n\t\t// ------------------------------------------------------------------------\n\t\t// Public Programming interface.\n\t\t// ------------------------------------------------------------------------\n\n\t\t/**\n\t * The JavaScript application communicates to the server using a {@link Paho.Client} object.\n\t * <p>\n\t * Most applications will create just one Client object and then call its connect() method,\n\t * however applications can create more than one Client object if they wish.\n\t * In this case the combination of host, port and clientId attributes must be different for each Client object.\n\t * <p>\n\t * The send, subscribe and unsubscribe methods are implemented as asynchronous JavaScript methods\n\t * (even though the underlying protocol exchange might be synchronous in nature).\n\t * This means they signal their completion by calling back to the application,\n\t * via Success or Failure callback functions provided by the application on the method in question.\n\t * Such callbacks are called at most once per method invocation and do not persist beyond the lifetime\n\t * of the script that made the invocation.\n\t * <p>\n\t * In contrast there are some callback functions, most notably <i>onMessageArrived</i>,\n\t * that are defined on the {@link Paho.Client} object.\n\t * These may get called multiple times, and aren't directly related to specific method invocations made by the client.\n\t *\n\t * @name Paho.Client\n\t *\n\t * @constructor\n\t *\n\t * @param {string} host - the address of the messaging server, as a fully qualified WebSocket URI, as a DNS name or dotted decimal IP address.\n\t * @param {number} port - the port number to connect to - only required if host is not a URI\n\t * @param {string} path - the path on the host to connect to - only used if host is not a URI. Default: '/mqtt'.\n\t * @param {string} clientId - the Messaging client identifier, between 1 and 23 characters in length.\n\t *\n\t * @property {string} host - <i>read only</i> the server's DNS hostname or dotted decimal IP address.\n\t * @property {number} port - <i>read only</i> the server's port.\n\t * @property {string} path - <i>read only</i> the server's path.\n\t * @property {string} clientId - <i>read only</i> used when connecting to the server.\n\t * @property {function} onConnectionLost - called when a connection has been lost.\n\t *                            after a connect() method has succeeded.\n\t *                            Establish the call back used when a connection has been lost. The connection may be\n\t *                            lost because the client initiates a disconnect or because the server or network\n\t *                            cause the client to be disconnected. The disconnect call back may be called without\n\t *                            the connectionComplete call back being invoked if, for example the client fails to\n\t *                            connect.\n\t *                            A single response object parameter is passed to the onConnectionLost callback containing the following fields:\n\t *                            <ol>\n\t *                            <li>errorCode\n\t *                            <li>errorMessage\n\t *                            </ol>\n\t * @property {function} onMessageDelivered - called when a message has been delivered.\n\t *                            All processing that this Client will ever do has been completed. So, for example,\n\t *                            in the case of a Qos=2 message sent by this client, the PubComp flow has been received from the server\n\t *                            and the message has been removed from persistent storage before this callback is invoked.\n\t *                            Parameters passed to the onMessageDelivered callback are:\n\t *                            <ol>\n\t *                            <li>{@link Paho.Message} that was delivered.\n\t *                            </ol>\n\t * @property {function} onMessageArrived - called when a message has arrived in this Paho.client.\n\t *                            Parameters passed to the onMessageArrived callback are:\n\t *                            <ol>\n\t *                            <li>{@link Paho.Message} that has arrived.\n\t *                            </ol>\n\t * @property {function} onConnected - called when a connection is successfully made to the server.\n\t *                                  after a connect() method.\n\t *                                  Parameters passed to the onConnected callback are:\n\t *                                  <ol>\n\t *                                  <li>reconnect (boolean) - If true, the connection was the result of a reconnect.</li>\n\t *                                  <li>URI (string) - The URI used to connect to the server.</li>\n\t *                                  </ol>\n\t * @property {boolean} disconnectedPublishing - if set, will enable disconnected publishing in\n\t *                                            in the event that the connection to the server is lost.\n\t * @property {number} disconnectedBufferSize - Used to set the maximum number of messages that the disconnected\n\t *                                             buffer will hold before rejecting new messages. Default size: 5000 messages\n\t * @property {function} trace - called whenever trace is called. TODO\n\t */\n\t\tvar Client = function (host, port, path, clientId) {\n\n\t\t\tvar uri;\n\n\t\t\tif (typeof host !== \"string\")\n\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof host, \"host\"]));\n\n\t\t\tif (arguments.length == 2) {\n\t\t\t// host: must be full ws:// uri\n\t\t\t// port: clientId\n\t\t\t\tclientId = port;\n\t\t\t\turi = host;\n\t\t\t\tvar match = uri.match(/^(wss?):\\/\\/((\\[(.+)\\])|([^\\/]+?))(:(\\d+))?(\\/.*)$/);\n\t\t\t\tif (match) {\n\t\t\t\t\thost = match[4]||match[2];\n\t\t\t\t\tport = parseInt(match[7]);\n\t\t\t\t\tpath = match[8];\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT,[host,\"host\"]));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (arguments.length == 3) {\n\t\t\t\t\tclientId = path;\n\t\t\t\t\tpath = \"/mqtt\";\n\t\t\t\t}\n\t\t\t\tif (typeof port !== \"number\" || port < 0)\n\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof port, \"port\"]));\n\t\t\t\tif (typeof path !== \"string\")\n\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof path, \"path\"]));\n\n\t\t\t\tvar ipv6AddSBracket = (host.indexOf(\":\") !== -1 && host.slice(0,1) !== \"[\" && host.slice(-1) !== \"]\");\n\t\t\t\turi = \"ws://\"+(ipv6AddSBracket?\"[\"+host+\"]\":host)+\":\"+port+path;\n\t\t\t}\n\n\t\t\tvar clientIdLength = 0;\n\t\t\tfor (var i = 0; i<clientId.length; i++) {\n\t\t\t\tvar charCode = clientId.charCodeAt(i);\n\t\t\t\tif (0xD800 <= charCode && charCode <= 0xDBFF)  {\n\t\t\t\t\ti++; // Surrogate pair.\n\t\t\t\t}\n\t\t\t\tclientIdLength++;\n\t\t\t}\n\t\t\tif (typeof clientId !== \"string\" || clientIdLength > 65535)\n\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [clientId, \"clientId\"]));\n\n\t\t\tvar client = new ClientImpl(uri, host, port, path, clientId);\n\n\t\t\t//Public Properties\n\t\t\tObject.defineProperties(this,{\n\t\t\t\t\"host\":{\n\t\t\t\t\tget: function() { return host; },\n\t\t\t\t\tset: function() { throw new Error(format(ERROR.UNSUPPORTED_OPERATION)); }\n\t\t\t\t},\n\t\t\t\t\"port\":{\n\t\t\t\t\tget: function() { return port; },\n\t\t\t\t\tset: function() { throw new Error(format(ERROR.UNSUPPORTED_OPERATION)); }\n\t\t\t\t},\n\t\t\t\t\"path\":{\n\t\t\t\t\tget: function() { return path; },\n\t\t\t\t\tset: function() { throw new Error(format(ERROR.UNSUPPORTED_OPERATION)); }\n\t\t\t\t},\n\t\t\t\t\"uri\":{\n\t\t\t\t\tget: function() { return uri; },\n\t\t\t\t\tset: function() { throw new Error(format(ERROR.UNSUPPORTED_OPERATION)); }\n\t\t\t\t},\n\t\t\t\t\"clientId\":{\n\t\t\t\t\tget: function() { return client.clientId; },\n\t\t\t\t\tset: function() { throw new Error(format(ERROR.UNSUPPORTED_OPERATION)); }\n\t\t\t\t},\n\t\t\t\t\"onConnected\":{\n\t\t\t\t\tget: function() { return client.onConnected; },\n\t\t\t\t\tset: function(newOnConnected) {\n\t\t\t\t\t\tif (typeof newOnConnected === \"function\")\n\t\t\t\t\t\t\tclient.onConnected = newOnConnected;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof newOnConnected, \"onConnected\"]));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"disconnectedPublishing\":{\n\t\t\t\t\tget: function() { return client.disconnectedPublishing; },\n\t\t\t\t\tset: function(newDisconnectedPublishing) {\n\t\t\t\t\t\tclient.disconnectedPublishing = newDisconnectedPublishing;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"disconnectedBufferSize\":{\n\t\t\t\t\tget: function() { return client.disconnectedBufferSize; },\n\t\t\t\t\tset: function(newDisconnectedBufferSize) {\n\t\t\t\t\t\tclient.disconnectedBufferSize = newDisconnectedBufferSize;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"onConnectionLost\":{\n\t\t\t\t\tget: function() { return client.onConnectionLost; },\n\t\t\t\t\tset: function(newOnConnectionLost) {\n\t\t\t\t\t\tif (typeof newOnConnectionLost === \"function\")\n\t\t\t\t\t\t\tclient.onConnectionLost = newOnConnectionLost;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof newOnConnectionLost, \"onConnectionLost\"]));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"onMessageDelivered\":{\n\t\t\t\t\tget: function() { return client.onMessageDelivered; },\n\t\t\t\t\tset: function(newOnMessageDelivered) {\n\t\t\t\t\t\tif (typeof newOnMessageDelivered === \"function\")\n\t\t\t\t\t\t\tclient.onMessageDelivered = newOnMessageDelivered;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof newOnMessageDelivered, \"onMessageDelivered\"]));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"onMessageArrived\":{\n\t\t\t\t\tget: function() { return client.onMessageArrived; },\n\t\t\t\t\tset: function(newOnMessageArrived) {\n\t\t\t\t\t\tif (typeof newOnMessageArrived === \"function\")\n\t\t\t\t\t\t\tclient.onMessageArrived = newOnMessageArrived;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof newOnMessageArrived, \"onMessageArrived\"]));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"trace\":{\n\t\t\t\t\tget: function() { return client.traceFunction; },\n\t\t\t\t\tset: function(trace) {\n\t\t\t\t\t\tif(typeof trace === \"function\"){\n\t\t\t\t\t\t\tclient.traceFunction = trace;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof trace, \"onTrace\"]));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\n\t\t\t/**\n\t\t * Connect this Messaging client to its server.\n\t\t *\n\t\t * @name Paho.Client#connect\n\t\t * @function\n\t\t * @param {object} connectOptions - Attributes used with the connection.\n\t\t * @param {number} connectOptions.timeout - If the connect has not succeeded within this\n\t\t *                    number of seconds, it is deemed to have failed.\n\t\t *                    The default is 30 seconds.\n\t\t * @param {string} connectOptions.userName - Authentication username for this connection.\n\t\t * @param {string} connectOptions.password - Authentication password for this connection.\n\t\t * @param {Paho.Message} connectOptions.willMessage - sent by the server when the client\n\t\t *                    disconnects abnormally.\n\t\t * @param {number} connectOptions.keepAliveInterval - the server disconnects this client if\n\t\t *                    there is no activity for this number of seconds.\n\t\t *                    The default value of 60 seconds is assumed if not set.\n\t\t * @param {boolean} connectOptions.cleanSession - if true(default) the client and server\n\t\t *                    persistent state is deleted on successful connect.\n\t\t * @param {boolean} connectOptions.useSSL - if present and true, use an SSL Websocket connection.\n\t\t * @param {object} connectOptions.invocationContext - passed to the onSuccess callback or onFailure callback.\n\t\t * @param {function} connectOptions.onSuccess - called when the connect acknowledgement\n\t\t *                    has been received from the server.\n\t\t * A single response object parameter is passed to the onSuccess callback containing the following fields:\n\t\t * <ol>\n\t\t * <li>invocationContext as passed in to the onSuccess method in the connectOptions.\n\t\t * </ol>\n\t * @param {function} connectOptions.onFailure - called when the connect request has failed or timed out.\n\t\t * A single response object parameter is passed to the onFailure callback containing the following fields:\n\t\t * <ol>\n\t\t * <li>invocationContext as passed in to the onFailure method in the connectOptions.\n\t\t * <li>errorCode a number indicating the nature of the error.\n\t\t * <li>errorMessage text describing the error.\n\t\t * </ol>\n\t * @param {array} connectOptions.hosts - If present this contains either a set of hostnames or fully qualified\n\t\t * WebSocket URIs (ws://iot.eclipse.org:80/ws), that are tried in order in place\n\t\t * of the host and port paramater on the construtor. The hosts are tried one at at time in order until\n\t\t * one of then succeeds.\n\t * @param {array} connectOptions.ports - If present the set of ports matching the hosts. If hosts contains URIs, this property\n\t\t * is not used.\n\t * @param {boolean} connectOptions.reconnect - Sets whether the client will automatically attempt to reconnect\n\t * to the server if the connection is lost.\n\t *<ul>\n\t *<li>If set to false, the client will not attempt to automatically reconnect to the server in the event that the\n\t * connection is lost.</li>\n\t *<li>If set to true, in the event that the connection is lost, the client will attempt to reconnect to the server.\n\t * It will initially wait 1 second before it attempts to reconnect, for every failed reconnect attempt, the delay\n\t * will double until it is at 2 minutes at which point the delay will stay at 2 minutes.</li>\n\t *</ul>\n\t * @param {number} connectOptions.mqttVersion - The version of MQTT to use to connect to the MQTT Broker.\n\t *<ul>\n\t *<li>3 - MQTT V3.1</li>\n\t *<li>4 - MQTT V3.1.1</li>\n\t *</ul>\n\t * @param {boolean} connectOptions.mqttVersionExplicit - If set to true, will force the connection to use the\n\t * selected MQTT Version or will fail to connect.\n\t * @param {array} connectOptions.uris - If present, should contain a list of fully qualified WebSocket uris\n\t * (e.g. ws://iot.eclipse.org:80/ws), that are tried in order in place of the host and port parameter of the construtor.\n\t * The uris are tried one at a time in order until one of them succeeds. Do not use this in conjunction with hosts as\n\t * the hosts array will be converted to uris and will overwrite this property.\n\t\t * @throws {InvalidState} If the client is not in disconnected state. The client must have received connectionLost\n\t\t * or disconnected before calling connect for a second or subsequent time.\n\t\t */\n\t\t\tthis.connect = function (connectOptions) {\n\t\t\t\tconnectOptions = connectOptions || {} ;\n\t\t\t\tvalidate(connectOptions,  {timeout:\"number\",\n\t\t\t\t\tuserName:\"string\",\n\t\t\t\t\tpassword:\"string\",\n\t\t\t\t\twillMessage:\"object\",\n\t\t\t\t\tkeepAliveInterval:\"number\",\n\t\t\t\t\tcleanSession:\"boolean\",\n\t\t\t\t\tuseSSL:\"boolean\",\n\t\t\t\t\tinvocationContext:\"object\",\n\t\t\t\t\tonSuccess:\"function\",\n\t\t\t\t\tonFailure:\"function\",\n\t\t\t\t\thosts:\"object\",\n\t\t\t\t\tports:\"object\",\n\t\t\t\t\treconnect:\"boolean\",\n\t\t\t\t\tmqttVersion:\"number\",\n\t\t\t\t\tmqttVersionExplicit:\"boolean\",\n\t\t\t\t\turis: \"object\"});\n\n\t\t\t\t// If no keep alive interval is set, assume 60 seconds.\n\t\t\t\tif (connectOptions.keepAliveInterval === undefined)\n\t\t\t\t\tconnectOptions.keepAliveInterval = 60;\n\n\t\t\t\tif (connectOptions.mqttVersion > 4 || connectOptions.mqttVersion < 3) {\n\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.mqttVersion, \"connectOptions.mqttVersion\"]));\n\t\t\t\t}\n\n\t\t\t\tif (connectOptions.mqttVersion === undefined) {\n\t\t\t\t\tconnectOptions.mqttVersionExplicit = false;\n\t\t\t\t\tconnectOptions.mqttVersion = 4;\n\t\t\t\t} else {\n\t\t\t\t\tconnectOptions.mqttVersionExplicit = true;\n\t\t\t\t}\n\n\t\t\t\t//Check that if password is set, so is username\n\t\t\t\tif (connectOptions.password !== undefined && connectOptions.userName === undefined)\n\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.password, \"connectOptions.password\"]));\n\n\t\t\t\tif (connectOptions.willMessage) {\n\t\t\t\t\tif (!(connectOptions.willMessage instanceof Message))\n\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [connectOptions.willMessage, \"connectOptions.willMessage\"]));\n\t\t\t\t\t// The will message must have a payload that can be represented as a string.\n\t\t\t\t\t// Cause the willMessage to throw an exception if this is not the case.\n\t\t\t\t\tconnectOptions.willMessage.stringPayload = null;\n\n\t\t\t\t\tif (typeof connectOptions.willMessage.destinationName === \"undefined\")\n\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof connectOptions.willMessage.destinationName, \"connectOptions.willMessage.destinationName\"]));\n\t\t\t\t}\n\t\t\t\tif (typeof connectOptions.cleanSession === \"undefined\")\n\t\t\t\t\tconnectOptions.cleanSession = true;\n\t\t\t\tif (connectOptions.hosts) {\n\n\t\t\t\t\tif (!(connectOptions.hosts instanceof Array) )\n\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts, \"connectOptions.hosts\"]));\n\t\t\t\t\tif (connectOptions.hosts.length <1 )\n\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts, \"connectOptions.hosts\"]));\n\n\t\t\t\t\tvar usingURIs = false;\n\t\t\t\t\tfor (var i = 0; i<connectOptions.hosts.length; i++) {\n\t\t\t\t\t\tif (typeof connectOptions.hosts[i] !== \"string\")\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof connectOptions.hosts[i], \"connectOptions.hosts[\"+i+\"]\"]));\n\t\t\t\t\t\tif (/^(wss?):\\/\\/((\\[(.+)\\])|([^\\/]+?))(:(\\d+))?(\\/.*)$/.test(connectOptions.hosts[i])) {\n\t\t\t\t\t\t\tif (i === 0) {\n\t\t\t\t\t\t\t\tusingURIs = true;\n\t\t\t\t\t\t\t} else if (!usingURIs) {\n\t\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts[i], \"connectOptions.hosts[\"+i+\"]\"]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (usingURIs) {\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts[i], \"connectOptions.hosts[\"+i+\"]\"]));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!usingURIs) {\n\t\t\t\t\t\tif (!connectOptions.ports)\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.ports, \"connectOptions.ports\"]));\n\t\t\t\t\t\tif (!(connectOptions.ports instanceof Array) )\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.ports, \"connectOptions.ports\"]));\n\t\t\t\t\t\tif (connectOptions.hosts.length !== connectOptions.ports.length)\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.ports, \"connectOptions.ports\"]));\n\n\t\t\t\t\t\tconnectOptions.uris = [];\n\n\t\t\t\t\t\tfor (var i = 0; i<connectOptions.hosts.length; i++) {\n\t\t\t\t\t\t\tif (typeof connectOptions.ports[i] !== \"number\" || connectOptions.ports[i] < 0)\n\t\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof connectOptions.ports[i], \"connectOptions.ports[\"+i+\"]\"]));\n\t\t\t\t\t\t\tvar host = connectOptions.hosts[i];\n\t\t\t\t\t\t\tvar port = connectOptions.ports[i];\n\n\t\t\t\t\t\t\tvar ipv6 = (host.indexOf(\":\") !== -1);\n\t\t\t\t\t\t\turi = \"ws://\"+(ipv6?\"[\"+host+\"]\":host)+\":\"+port+path;\n\t\t\t\t\t\t\tconnectOptions.uris.push(uri);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconnectOptions.uris = connectOptions.hosts;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tclient.connect(connectOptions);\n\t\t\t};\n\n\t\t\t/**\n\t\t * Subscribe for messages, request receipt of a copy of messages sent to the destinations described by the filter.\n\t\t *\n\t\t * @name Paho.Client#subscribe\n\t\t * @function\n\t\t * @param {string} filter describing the destinations to receive messages from.\n\t\t * <br>\n\t\t * @param {object} subscribeOptions - used to control the subscription\n\t\t *\n\t\t * @param {number} subscribeOptions.qos - the maximum qos of any publications sent\n\t\t *                                  as a result of making this subscription.\n\t\t * @param {object} subscribeOptions.invocationContext - passed to the onSuccess callback\n\t\t *                                  or onFailure callback.\n\t\t * @param {function} subscribeOptions.onSuccess - called when the subscribe acknowledgement\n\t\t *                                  has been received from the server.\n\t\t *                                  A single response object parameter is passed to the onSuccess callback containing the following fields:\n\t\t *                                  <ol>\n\t\t *                                  <li>invocationContext if set in the subscribeOptions.\n\t\t *                                  </ol>\n\t\t * @param {function} subscribeOptions.onFailure - called when the subscribe request has failed or timed out.\n\t\t *                                  A single response object parameter is passed to the onFailure callback containing the following fields:\n\t\t *                                  <ol>\n\t\t *                                  <li>invocationContext - if set in the subscribeOptions.\n\t\t *                                  <li>errorCode - a number indicating the nature of the error.\n\t\t *                                  <li>errorMessage - text describing the error.\n\t\t *                                  </ol>\n\t\t * @param {number} subscribeOptions.timeout - which, if present, determines the number of\n\t\t *                                  seconds after which the onFailure calback is called.\n\t\t *                                  The presence of a timeout does not prevent the onSuccess\n\t\t *                                  callback from being called when the subscribe completes.\n\t\t * @throws {InvalidState} if the client is not in connected state.\n\t\t */\n\t\t\tthis.subscribe = function (filter, subscribeOptions) {\n\t\t\t\tif (typeof filter !== \"string\" && filter.constructor !== Array)\n\t\t\t\t\tthrow new Error(\"Invalid argument:\"+filter);\n\t\t\t\tsubscribeOptions = subscribeOptions || {} ;\n\t\t\t\tvalidate(subscribeOptions,  {qos:\"number\",\n\t\t\t\t\tinvocationContext:\"object\",\n\t\t\t\t\tonSuccess:\"function\",\n\t\t\t\t\tonFailure:\"function\",\n\t\t\t\t\ttimeout:\"number\"\n\t\t\t\t});\n\t\t\t\tif (subscribeOptions.timeout && !subscribeOptions.onFailure)\n\t\t\t\t\tthrow new Error(\"subscribeOptions.timeout specified with no onFailure callback.\");\n\t\t\t\tif (typeof subscribeOptions.qos !== \"undefined\" && !(subscribeOptions.qos === 0 || subscribeOptions.qos === 1 || subscribeOptions.qos === 2 ))\n\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [subscribeOptions.qos, \"subscribeOptions.qos\"]));\n\t\t\t\tclient.subscribe(filter, subscribeOptions);\n\t\t\t};\n\n\t\t/**\n\t\t * Unsubscribe for messages, stop receiving messages sent to destinations described by the filter.\n\t\t *\n\t\t * @name Paho.Client#unsubscribe\n\t\t * @function\n\t\t * @param {string} filter - describing the destinations to receive messages from.\n\t\t * @param {object} unsubscribeOptions - used to control the subscription\n\t\t * @param {object} unsubscribeOptions.invocationContext - passed to the onSuccess callback\n\t\t\t\t\t\t\t\t\t\t\t  or onFailure callback.\n\t\t * @param {function} unsubscribeOptions.onSuccess - called when the unsubscribe acknowledgement has been received from the server.\n\t\t *                                    A single response object parameter is passed to the\n\t\t *                                    onSuccess callback containing the following fields:\n\t\t *                                    <ol>\n\t\t *                                    <li>invocationContext - if set in the unsubscribeOptions.\n\t\t *                                    </ol>\n\t\t * @param {function} unsubscribeOptions.onFailure called when the unsubscribe request has failed or timed out.\n\t\t *                                    A single response object parameter is passed to the onFailure callback containing the following fields:\n\t\t *                                    <ol>\n\t\t *                                    <li>invocationContext - if set in the unsubscribeOptions.\n\t\t *                                    <li>errorCode - a number indicating the nature of the error.\n\t\t *                                    <li>errorMessage - text describing the error.\n\t\t *                                    </ol>\n\t\t * @param {number} unsubscribeOptions.timeout - which, if present, determines the number of seconds\n\t\t *                                    after which the onFailure callback is called. The presence of\n\t\t *                                    a timeout does not prevent the onSuccess callback from being\n\t\t *                                    called when the unsubscribe completes\n\t\t * @throws {InvalidState} if the client is not in connected state.\n\t\t */\n\t\t\tthis.unsubscribe = function (filter, unsubscribeOptions) {\n\t\t\t\tif (typeof filter !== \"string\" && filter.constructor !== Array)\n\t\t\t\t\tthrow new Error(\"Invalid argument:\"+filter);\n\t\t\t\tunsubscribeOptions = unsubscribeOptions || {} ;\n\t\t\t\tvalidate(unsubscribeOptions,  {invocationContext:\"object\",\n\t\t\t\t\tonSuccess:\"function\",\n\t\t\t\t\tonFailure:\"function\",\n\t\t\t\t\ttimeout:\"number\"\n\t\t\t\t});\n\t\t\t\tif (unsubscribeOptions.timeout && !unsubscribeOptions.onFailure)\n\t\t\t\t\tthrow new Error(\"unsubscribeOptions.timeout specified with no onFailure callback.\");\n\t\t\t\tclient.unsubscribe(filter, unsubscribeOptions);\n\t\t\t};\n\n\t\t\t/**\n\t\t * Send a message to the consumers of the destination in the Message.\n\t\t *\n\t\t * @name Paho.Client#send\n\t\t * @function\n\t\t * @param {string|Paho.Message} topic - <b>mandatory</b> The name of the destination to which the message is to be sent.\n\t\t * \t\t\t\t\t   - If it is the only parameter, used as Paho.Message object.\n\t\t * @param {String|ArrayBuffer} payload - The message data to be sent.\n\t\t * @param {number} qos The Quality of Service used to deliver the message.\n\t\t * \t\t<dl>\n\t\t * \t\t\t<dt>0 Best effort (default).\n\t\t *     \t\t\t<dt>1 At least once.\n\t\t *     \t\t\t<dt>2 Exactly once.\n\t\t * \t\t</dl>\n\t\t * @param {Boolean} retained If true, the message is to be retained by the server and delivered\n\t\t *                     to both current and future subscriptions.\n\t\t *                     If false the server only delivers the message to current subscribers, this is the default for new Messages.\n\t\t *                     A received message has the retained boolean set to true if the message was published\n\t\t *                     with the retained boolean set to true\n\t\t *                     and the subscrption was made after the message has been published.\n\t\t * @throws {InvalidState} if the client is not connected.\n\t\t */\n\t\t\tthis.send = function (topic,payload,qos,retained) {\n\t\t\t\tvar message ;\n\n\t\t\t\tif(arguments.length === 0){\n\t\t\t\t\tthrow new Error(\"Invalid argument.\"+\"length\");\n\n\t\t\t\t}else if(arguments.length == 1) {\n\n\t\t\t\t\tif (!(topic instanceof Message) && (typeof topic !== \"string\"))\n\t\t\t\t\t\tthrow new Error(\"Invalid argument:\"+ typeof topic);\n\n\t\t\t\t\tmessage = topic;\n\t\t\t\t\tif (typeof message.destinationName === \"undefined\")\n\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT,[message.destinationName,\"Message.destinationName\"]));\n\t\t\t\t\tclient.send(message);\n\n\t\t\t\t}else {\n\t\t\t\t//parameter checking in Message object\n\t\t\t\t\tmessage = new Message(payload);\n\t\t\t\t\tmessage.destinationName = topic;\n\t\t\t\t\tif(arguments.length >= 3)\n\t\t\t\t\t\tmessage.qos = qos;\n\t\t\t\t\tif(arguments.length >= 4)\n\t\t\t\t\t\tmessage.retained = retained;\n\t\t\t\t\tclient.send(message);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t/**\n\t\t * Publish a message to the consumers of the destination in the Message.\n\t\t * Synonym for Paho.Mqtt.Client#send\n\t\t *\n\t\t * @name Paho.Client#publish\n\t\t * @function\n\t\t * @param {string|Paho.Message} topic - <b>mandatory</b> The name of the topic to which the message is to be published.\n\t\t * \t\t\t\t\t   - If it is the only parameter, used as Paho.Message object.\n\t\t * @param {String|ArrayBuffer} payload - The message data to be published.\n\t\t * @param {number} qos The Quality of Service used to deliver the message.\n\t\t * \t\t<dl>\n\t\t * \t\t\t<dt>0 Best effort (default).\n\t\t *     \t\t\t<dt>1 At least once.\n\t\t *     \t\t\t<dt>2 Exactly once.\n\t\t * \t\t</dl>\n\t\t * @param {Boolean} retained If true, the message is to be retained by the server and delivered\n\t\t *                     to both current and future subscriptions.\n\t\t *                     If false the server only delivers the message to current subscribers, this is the default for new Messages.\n\t\t *                     A received message has the retained boolean set to true if the message was published\n\t\t *                     with the retained boolean set to true\n\t\t *                     and the subscrption was made after the message has been published.\n\t\t * @throws {InvalidState} if the client is not connected.\n\t\t */\n\t\t\tthis.publish = function(topic,payload,qos,retained) {\n\t\t\t\tvar message ;\n\n\t\t\t\tif(arguments.length === 0){\n\t\t\t\t\tthrow new Error(\"Invalid argument.\"+\"length\");\n\n\t\t\t\t}else if(arguments.length == 1) {\n\n\t\t\t\t\tif (!(topic instanceof Message) && (typeof topic !== \"string\"))\n\t\t\t\t\t\tthrow new Error(\"Invalid argument:\"+ typeof topic);\n\n\t\t\t\t\tmessage = topic;\n\t\t\t\t\tif (typeof message.destinationName === \"undefined\")\n\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT,[message.destinationName,\"Message.destinationName\"]));\n\t\t\t\t\tclient.send(message);\n\n\t\t\t\t}else {\n\t\t\t\t\t//parameter checking in Message object\n\t\t\t\t\tmessage = new Message(payload);\n\t\t\t\t\tmessage.destinationName = topic;\n\t\t\t\t\tif(arguments.length >= 3)\n\t\t\t\t\t\tmessage.qos = qos;\n\t\t\t\t\tif(arguments.length >= 4)\n\t\t\t\t\t\tmessage.retained = retained;\n\t\t\t\t\tclient.send(message);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t/**\n\t\t * Normal disconnect of this Messaging client from its server.\n\t\t *\n\t\t * @name Paho.Client#disconnect\n\t\t * @function\n\t\t * @throws {InvalidState} if the client is already disconnected.\n\t\t */\n\t\t\tthis.disconnect = function () {\n\t\t\t\tclient.disconnect();\n\t\t\t};\n\n\t\t\t/**\n\t\t * Get the contents of the trace log.\n\t\t *\n\t\t * @name Paho.Client#getTraceLog\n\t\t * @function\n\t\t * @return {Object[]} tracebuffer containing the time ordered trace records.\n\t\t */\n\t\t\tthis.getTraceLog = function () {\n\t\t\t\treturn client.getTraceLog();\n\t\t\t};\n\n\t\t\t/**\n\t\t * Start tracing.\n\t\t *\n\t\t * @name Paho.Client#startTrace\n\t\t * @function\n\t\t */\n\t\t\tthis.startTrace = function () {\n\t\t\t\tclient.startTrace();\n\t\t\t};\n\n\t\t\t/**\n\t\t * Stop tracing.\n\t\t *\n\t\t * @name Paho.Client#stopTrace\n\t\t * @function\n\t\t */\n\t\t\tthis.stopTrace = function () {\n\t\t\t\tclient.stopTrace();\n\t\t\t};\n\n\t\t\tthis.isConnected = function() {\n\t\t\t\treturn client.connected;\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t * An application message, sent or received.\n\t * <p>\n\t * All attributes may be null, which implies the default values.\n\t *\n\t * @name Paho.Message\n\t * @constructor\n\t * @param {String|ArrayBuffer} payload The message data to be sent.\n\t * <p>\n\t * @property {string} payloadString <i>read only</i> The payload as a string if the payload consists of valid UTF-8 characters.\n\t * @property {ArrayBuffer} payloadBytes <i>read only</i> The payload as an ArrayBuffer.\n\t * <p>\n\t * @property {string} destinationName <b>mandatory</b> The name of the destination to which the message is to be sent\n\t *                    (for messages about to be sent) or the name of the destination from which the message has been received.\n\t *                    (for messages received by the onMessage function).\n\t * <p>\n\t * @property {number} qos The Quality of Service used to deliver the message.\n\t * <dl>\n\t *     <dt>0 Best effort (default).\n\t *     <dt>1 At least once.\n\t *     <dt>2 Exactly once.\n\t * </dl>\n\t * <p>\n\t * @property {Boolean} retained If true, the message is to be retained by the server and delivered\n\t *                     to both current and future subscriptions.\n\t *                     If false the server only delivers the message to current subscribers, this is the default for new Messages.\n\t *                     A received message has the retained boolean set to true if the message was published\n\t *                     with the retained boolean set to true\n\t *                     and the subscrption was made after the message has been published.\n\t * <p>\n\t * @property {Boolean} duplicate <i>read only</i> If true, this message might be a duplicate of one which has already been received.\n\t *                     This is only set on messages received from the server.\n\t *\n\t */\n\t\tvar Message = function (newPayload) {\n\t\t\tvar payload;\n\t\t\tif (   typeof newPayload === \"string\" ||\n\t\tnewPayload instanceof ArrayBuffer ||\n\t\t(ArrayBuffer.isView(newPayload) && !(newPayload instanceof DataView))\n\t\t\t) {\n\t\t\t\tpayload = newPayload;\n\t\t\t} else {\n\t\t\t\tthrow (format(ERROR.INVALID_ARGUMENT, [newPayload, \"newPayload\"]));\n\t\t\t}\n\n\t\t\tvar destinationName;\n\t\t\tvar qos = 0;\n\t\t\tvar retained = false;\n\t\t\tvar duplicate = false;\n\n\t\t\tObject.defineProperties(this,{\n\t\t\t\t\"payloadString\":{\n\t\t\t\t\tenumerable : true,\n\t\t\t\t\tget : function () {\n\t\t\t\t\t\tif (typeof payload === \"string\")\n\t\t\t\t\t\t\treturn payload;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\treturn parseUTF8(payload, 0, payload.length);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"payloadBytes\":{\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\tget: function() {\n\t\t\t\t\t\tif (typeof payload === \"string\") {\n\t\t\t\t\t\t\tvar buffer = new ArrayBuffer(UTF8Length(payload));\n\t\t\t\t\t\t\tvar byteStream = new Uint8Array(buffer);\n\t\t\t\t\t\t\tstringToUTF8(payload, byteStream, 0);\n\n\t\t\t\t\t\t\treturn byteStream;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn payload;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"destinationName\":{\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\tget: function() { return destinationName; },\n\t\t\t\t\tset: function(newDestinationName) {\n\t\t\t\t\t\tif (typeof newDestinationName === \"string\")\n\t\t\t\t\t\t\tdestinationName = newDestinationName;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [newDestinationName, \"newDestinationName\"]));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"qos\":{\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\tget: function() { return qos; },\n\t\t\t\t\tset: function(newQos) {\n\t\t\t\t\t\tif (newQos === 0 || newQos === 1 || newQos === 2 )\n\t\t\t\t\t\t\tqos = newQos;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tthrow new Error(\"Invalid argument:\"+newQos);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"retained\":{\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\tget: function() { return retained; },\n\t\t\t\t\tset: function(newRetained) {\n\t\t\t\t\t\tif (typeof newRetained === \"boolean\")\n\t\t\t\t\t\t\tretained = newRetained;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [newRetained, \"newRetained\"]));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"topic\":{\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\tget: function() { return destinationName; },\n\t\t\t\t\tset: function(newTopic) {destinationName=newTopic;}\n\t\t\t\t},\n\t\t\t\t\"duplicate\":{\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\tget: function() { return duplicate; },\n\t\t\t\t\tset: function(newDuplicate) {duplicate=newDuplicate;}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t// Module contents.\n\t\treturn {\n\t\t\tClient: Client,\n\t\t\tMessage: Message\n\t\t};\n\t// eslint-disable-next-line no-nested-ternary\n\t})(typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {});\n\treturn PahoMQTT;\n});\n","import { Client } from \"paho-mqtt\";\r\nimport \"./bootstrap.cyborg.min.css\";\r\nimport \"./styles.css\";\r\n\r\nclass EventContribution {\r\n  static topic_base = EventContribution.simpleHash(window.location.hostname || \"localhost\") + \"/event/contribution/\";\r\n  static topic_comment = this.topic_base + \"comment\";\r\n  static topic_note = this.topic_base + \"note\";\r\n  static topic_message = this.topic_base + \"message\";\r\n  static topic_like = this.topic_base + \"like\";\r\n  static topic_highlight = this.topic_base + \"highlight\";\r\n  static topic_stats = \"$SYS/broker/clients\";\r\n\r\n  private host_client = \"client-\" + EventContribution.random_id();\r\n  // @ts-ignore: 2 parameter call handled internally\r\n  private mqtt = new Client(EventContribution.mqttUrl(), this.host_client) as any;\r\n  private storage = { comments: {}, messages: {} };\r\n  private functions: { [index: string]: (evt: UIEvent) => any };\r\n\r\n  constructor() {\r\n    this.connect();\r\n    this.functions = {\r\n      deleteComment: this.deleteComment,\r\n      deleteMessage: this.deleteMessage,\r\n      highlightMessage: this.highlightMessage,\r\n      likeMessage: this.likeMessage,\r\n      sendComment: this.sendComment,\r\n      sendNote: this.sendNote,\r\n      takeComment: this.takeComment,\r\n    }\r\n  }\r\n\r\n  static random_id(): string {\r\n    return (\r\n      Number(String(Math.random()).slice(2)) +\r\n      Date.now() +\r\n      Math.round(performance.now())\r\n    ).toString(36);\r\n  }\r\n\r\n  static simpleHash(str: string): string {\r\n    let hash = 0\r\n    for (let i = 0; i < str.length; i++) {\r\n      hash = ((hash << 5) - hash + str.charCodeAt(i)) | 0\r\n    }\r\n    return (hash >>> 0).toString(36)\r\n  }\r\n\r\n  static mqttUrl(): string {\r\n    if (\r\n      window.location.hostname == \"localhost\" ||\r\n      window.location.hostname.endsWith(\".vercel.app\")\r\n    ) {\r\n      return \"wss://mqtt.eclipseprojects.io/mqtt\";\r\n    } else if (window.location.protocol == \"https:\") {\r\n      return `wss://${window.location.hostname}:${window.location.port}/mqtt`;\r\n    } else {\r\n      return `ws://${window.location.hostname}:${window.location.port}/mqtt`;\r\n    }\r\n  }\r\n\r\n  escapeHTML = (txt: string): string => {\r\n    const tmp = document.createElement(\"div\");\r\n    tmp.append(txt);\r\n    return tmp.innerHTML;\r\n  }\r\n\r\n  connect = (): void => {\r\n    this.mqtt.onMessageArrived = this.onReceive;\r\n    this.mqtt.onConnectionLost = this.onFailure;\r\n    this.showToast(\"Verbinde zum Server\");\r\n    try {\r\n      this.mqtt.connect({\r\n        onSuccess: this.onConnect,\r\n        onFailure: this.onFailure,\r\n      });\r\n    } catch (err) {\r\n      console.log(err);\r\n      this.showToast(\"FEHLER: Versuche die Seite neu zu laden.\");\r\n    }\r\n  }\r\n\r\n  send = (\r\n    topic: string,\r\n    payload: string,\r\n    retain: boolean = false\r\n  ): boolean => {\r\n    try {\r\n      this.showToast();\r\n      this.mqtt.send(topic, payload, 1, retain);\r\n      return true;\r\n    } catch (err) {\r\n      console.log(err);\r\n      this.showToast(\"FEHLER: Versuche es erneut.\");\r\n    }\r\n    return false;\r\n  }\r\n\r\n  showToast = (txt?: string): void => {\r\n    const elem = document.getElementById(\"toast\");\r\n    if (txt) {\r\n      this.addFromTemplate(\"template-toast\", \"toast-host\", { text: txt });\r\n    } else if (elem) {\r\n      elem.remove();\r\n    }\r\n  }\r\n\r\n  onFailure = (err): void => {\r\n    console.log(err);\r\n    this.showToast(\"FEHLER: Neue Verbindung in 2 Sekunden.\");\r\n    window.setTimeout(this.connect, 2000);\r\n  }\r\n\r\n  onConnect = (): void => {\r\n    this.showToast();\r\n    try {\r\n      this.mqtt.subscribe(EventContribution.topic_note, { qos: 1 });\r\n      this.mqtt.subscribe(EventContribution.topic_message + \"/+\", { qos: 1 });\r\n      this.mqtt.subscribe(EventContribution.topic_highlight, { qos: 1 });\r\n      if (document.querySelector(\"body[data-is-admin]\")) {\r\n        this.mqtt.subscribe(EventContribution.topic_comment + \"/+\", { qos: 1 });\r\n        this.mqtt.subscribe(EventContribution.topic_like + \"/+/+\", { qos: 1 });\r\n        this.mqtt.subscribe(EventContribution.topic_stats + \"/#\", { qos: 1 });\r\n      }\r\n      // bind keypress\r\n      document.querySelectorAll(\"[data-bind-keypress]\").forEach((elem) => {\r\n        if (!(elem instanceof HTMLElement) || !elem.dataset.bindKeypress) return\r\n        elem.addEventListener(\r\n          \"keypress\",\r\n          this.functions[((elem).dataset.bindKeypress)]\r\n        );\r\n      });\r\n      // bind click\r\n      document.querySelectorAll(\"[data-bind-click]\").forEach((elem) => {\r\n        if (!(elem instanceof HTMLElement) || !elem.dataset.bindClick) return\r\n        try {\r\n          elem.addEventListener(\r\n            \"click\",\r\n            this.functions[((elem).dataset.bindClick)]\r\n          );\r\n        } catch (err) {\r\n          console.log(\"unable to bind function\", elem, err);\r\n        }\r\n      });\r\n    } catch (err) {\r\n      console.log(err);\r\n      this.showToast(\"FEHLER: Versuche die Seite neu zu laden.\");\r\n    }\r\n  }\r\n\r\n  onReceive = (msg: any): void => {\r\n    try {\r\n      // stats\r\n      if (msg.destinationName.startsWith(EventContribution.topic_stats + \"/\")) {\r\n        this.receiveStats(msg.destinationName, msg.payloadString);\r\n      }\r\n      // comment\r\n      else if (msg.destinationName.startsWith(EventContribution.topic_comment + \"/\")) {\r\n        const subtopic = msg.destinationName.substr(EventContribution.topic_comment.length + 1);\r\n        this.receiveComment(subtopic, msg.payloadString);\r\n      }\r\n      // note\r\n      else if (msg.destinationName == EventContribution.topic_note) {\r\n        this.receiveNote(msg.payloadString);\r\n      }\r\n      // message\r\n      else if (msg.destinationName.startsWith(EventContribution.topic_message + \"/\")) {\r\n        const subtopic = msg.destinationName.substr(EventContribution.topic_message.length + 1);\r\n        this.receiveMessage(subtopic, msg.payloadString);\r\n      }\r\n      // like\r\n      else if (msg.destinationName.startsWith(EventContribution.topic_like + \"/\")) {\r\n        const subtopic = msg.destinationName.substr(EventContribution.topic_like.length + 1);\r\n        const paths = subtopic.split(\"/\");\r\n        this.receiveLike(paths[0], paths[1], msg.payloadString);\r\n      }\r\n      // highlight\r\n      else if (msg.destinationName == EventContribution.topic_highlight) {\r\n        this.receiveHighlight(msg.payloadString);\r\n      }\r\n      // unknown\r\n      else {\r\n        console.log(msg.destinationName, msg.payloadString);\r\n      }\r\n    } catch (err) {\r\n      console.log(\"failed to hande message\", err);\r\n    }\r\n  }\r\n\r\n  addFromTemplate = (\r\n    tmplId: string,\r\n    destId: string,\r\n    data: Object\r\n  ): HTMLElement | undefined => {\r\n    const tmpl = document.getElementById(tmplId);\r\n    const dest = document.getElementById(destId);\r\n    if (tmpl !== null && dest !== null) {\r\n      let html = tmpl.innerHTML;\r\n      // replace data\r\n      for (const key in data) {\r\n        html = html.split(\"{{\" + key + \"}}\").join(data[key]);\r\n      }\r\n      const tmp = document.createElement(\"div\");\r\n      tmp.innerHTML = html;\r\n      const tmp2 = tmp.firstElementChild as HTMLElement;\r\n      // bind click\r\n      tmp2.querySelectorAll(\"[data-bind-click]\").forEach((elem) => {\r\n        if (!(elem instanceof HTMLElement) || !(elem).dataset.bindClick) return\r\n        try {\r\n          elem.addEventListener(\r\n            \"click\",\r\n            this.functions[(elem).dataset.bindClick]\r\n          );\r\n        } catch (err) {\r\n          console.log(\"unable to bind function\", elem);\r\n        }\r\n      });\r\n      // replace old\r\n      const old = document.getElementById(tmp2.id);\r\n      if (tmp2.id && old !== null) {\r\n        old.parentNode?.replaceChild(tmp2, old);\r\n      } else {\r\n        dest.appendChild(tmp2);\r\n      }\r\n      // sort\r\n      const children = tmp2.parentNode?.querySelectorAll(\"[data-orderid]\");\r\n      if (children?.length) {\r\n        Array.from(children)\r\n          .sort(\r\n            (elem1, elem2) => {\r\n              if (!(elem1 instanceof HTMLElement) || !(elem1).dataset.orderid || !(elem2 instanceof HTMLElement) || !(elem2).dataset.orderid) return 0\r\n              return Number.parseInt((elem2).dataset.orderid) -\r\n                Number.parseInt((elem1).dataset.orderid)\r\n            }\r\n          )\r\n          .forEach((elem) => elem.parentNode?.appendChild(elem));\r\n      }\r\n      return tmp2;\r\n    }\r\n  }\r\n\r\n  findClosestInput = (elem: HTMLElement): HTMLInputElement | null | undefined => {\r\n    return elem.closest(\".input-group\")?.querySelector(\"input\");\r\n  }\r\n\r\n  removeById = (id: string): void => {\r\n    document.getElementById(id)?.remove();\r\n  }\r\n\r\n  receiveStats = (topic: string, txt: string): void => {\r\n    const dest = document.getElementById(\"stats-clients\");\r\n    if (topic == EventContribution.topic_stats + \"/connected\")\r\n      if (dest !== null) dest.innerHTML = txt;\r\n  }\r\n\r\n  sendComment = (evt: Event | KeyboardEvent): void => {\r\n    let target = evt.target as HTMLElement | null | undefined\r\n    if (\r\n      (evt instanceof KeyboardEvent &&\r\n        evt.type == \"keypress\" &&\r\n        evt.key == \"Enter\" &&\r\n        target instanceof HTMLInputElement &&\r\n        target.value) ||\r\n      (evt.type == \"click\" &&\r\n        target instanceof HTMLElement &&\r\n        (target = this.findClosestInput(target)) !== null &&\r\n        target instanceof HTMLInputElement &&\r\n        target.value)\r\n    ) {\r\n      if (this.send(EventContribution.topic_comment + \"/\" + EventContribution.random_id(), target.value, true)) {\r\n        target.value = \"\";\r\n      }\r\n    }\r\n  }\r\n\r\n  receiveComment = (id: string, txt: string): void => {\r\n    if (txt) {\r\n      this.storage.comments[id] = { text: txt };\r\n      const data = {\r\n        id: id,\r\n        text: this.escapeHTML(txt),\r\n        date: new Date().toLocaleString(),\r\n      };\r\n      this.addFromTemplate(\"template-comment\", \"comment-stream\", data);\r\n    } else {\r\n      delete this.storage.comments[id];\r\n      this.removeById(\"comment-\" + id);\r\n    }\r\n  }\r\n\r\n  takeComment = (evt: UIEvent): void => {\r\n    const target = evt.target as HTMLElement\r\n    const id = target.dataset.id;\r\n    if (!id) return;\r\n    //if (confirm(\"Diesen Kommentar wirklich übernehmen?\")) {\r\n    this.send(EventContribution.topic_comment + \"/\" + id, \"\", true);\r\n    this.sendMessage(id, this.storage.comments[id].text);\r\n    //}\r\n  }\r\n\r\n  deleteComment = (evt: UIEvent): void => {\r\n    const target = evt.target as HTMLElement\r\n    if (confirm(\"Diesen Kommentar wirklich löschen?\")) {\r\n      this.send(EventContribution.topic_comment + \"/\" + target.dataset.id, \"\", true);\r\n    }\r\n  }\r\n\r\n  sendNote = (evt: UIEvent): void => {\r\n    let target = evt.target as HTMLElement | null | undefined;\r\n    if (\r\n      (evt instanceof KeyboardEvent &&\r\n        target instanceof HTMLInputElement &&\r\n        evt.type == \"keypress\" &&\r\n        evt.key == \"Enter\") ||\r\n      (\r\n        target instanceof HTMLElement && evt.type == \"click\" && (target = this.findClosestInput(target)) !== null) && target instanceof HTMLElement\r\n    ) {\r\n      if (target instanceof HTMLInputElement && this.send(EventContribution.topic_note, target.value, true)) {\r\n        target.value = \"\";\r\n      }\r\n    }\r\n  }\r\n\r\n  receiveNote = (txt: string): void => {\r\n    if (txt) {\r\n      const data = { text: this.escapeHTML(txt) };\r\n      this.addFromTemplate(\"template-note\", \"note-stream\", data);\r\n    } else {\r\n      this.removeById(\"note-top\");\r\n    }\r\n  }\r\n\r\n  sendMessage = (id: string, txt: string, likes: number = 0): boolean => {\r\n    const data = JSON.stringify({ text: txt, likes: likes });\r\n    return this.send(EventContribution.topic_message + \"/\" + id, data, true);\r\n  }\r\n\r\n  receiveMessage = (id: string, input: string): void => {\r\n    if (input) {\r\n      const json = JSON.parse(input);\r\n      this.storage.messages[id] = {\r\n        text: json.text,\r\n        likes: json.likes,\r\n      };\r\n      const data = {\r\n        id: id,\r\n        text: this.escapeHTML(json.text),\r\n        likes: this.escapeHTML(json.likes),\r\n      };\r\n      this.addFromTemplate(\"template-message\", \"message-stream\", data);\r\n    } else {\r\n      delete this.storage.messages[id];\r\n      this.removeById(\"message-\" + id);\r\n    }\r\n  }\r\n\r\n  highlightMessage = (evt: UIEvent): boolean => {\r\n    const target = evt.target as HTMLElement\r\n    const id = target.dataset.id;\r\n    if (id && this.storage.messages[id]) {\r\n      const data = JSON.stringify(this.storage.messages[id]);\r\n      return this.send(EventContribution.topic_highlight, data);\r\n    } return false\r\n  }\r\n\r\n  likeMessage = (evt: UIEvent): void => {\r\n    const target = evt.target as HTMLElement\r\n    const id = target.dataset.id;\r\n    if (!id) return\r\n    // cookie\r\n    let liked: string[] = [];\r\n    try {\r\n      const value = \"; \" + document.cookie;\r\n      const parts = value.split(\"; liked=\");\r\n      if (parts.length == 2) {\r\n        liked = JSON.parse(parts.pop()?.split(\";\").shift() || \"\");\r\n      }\r\n    } catch (err) { }\r\n    // like if unliked\r\n    if (liked.indexOf(id) == -1) {\r\n      liked.push(id);\r\n      document.cookie = \"liked=\" + JSON.stringify(liked);\r\n      document.cookie = \"max-age=\" + 6 * 60 * 60;\r\n      if (this.send(EventContribution.topic_like + \"/\" + id + \"/\" + this.host_client, \"like\", true)) {\r\n        const data = { id: id };\r\n        this.addFromTemplate(\"template-likes-loading\", \"likes-\" + id, data);\r\n      }\r\n    }\r\n  }\r\n\r\n  deleteMessage = (evt: UIEvent): void => {\r\n    const target = evt.target as HTMLElement\r\n    if (confirm(\"Diese Nachricht wirklich löschen?\")) {\r\n      if (target.dataset.id) {\r\n        this.send(EventContribution.topic_message + \"/\" + target.dataset.id, \"\", true);\r\n      }\r\n    }\r\n  }\r\n\r\n  receiveLike = (id: string, client: string, txt: string): void => {\r\n    if (txt && this.storage.messages[id]) {\r\n      this.sendMessage(id, this.storage.messages[id].text, this.storage.messages[id].likes + 1);\r\n      this.send(EventContribution.topic_like + \"/\" + id + \"/\" + client, \"\", true);\r\n    }\r\n  }\r\n\r\n  receiveHighlight = (txt: string): void => {\r\n    const data = JSON.parse(txt);\r\n    if (!data) return\r\n    this.addFromTemplate(\"template-highlight\", \"highlight-stream\", data);\r\n  }\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => new EventContribution());"],"names":["exports","PahoMQTT","global","data","localStorage","setItem","key","item","getItem","removeItem","MESSAGE_TYPE","validate","obj","keys","hasOwnProperty","errorStr","validKey","Error","format","ERROR","INVALID_TYPE","scope","f","apply","arguments","OK","code","text","CONNECT_TIMEOUT","SUBSCRIBE_TIMEOUT","UNSUBSCRIBE_TIMEOUT","PING_TIMEOUT","INTERNAL_ERROR","CONNACK_RETURNCODE","SOCKET_ERROR","SOCKET_CLOSE","MALFORMED_UTF","UNSUPPORTED","INVALID_STATE","INVALID_ARGUMENT","UNSUPPORTED_OPERATION","INVALID_STORED_DATA","INVALID_MQTT_MESSAGE_TYPE","MALFORMED_UNICODE","BUFFER_FULL","CONNACK_RC","error","substitutions","field","start","i","length","indexOf","part1","substring","part2","MqttProtoIdentifierv3","MqttProtoIdentifierv4","WireMessage","type","options","name","this","decodeMessage","input","pos","digit","startingPos","first","messageInfo","remLength","multiplier","endPos","wireMessage","sessionPresent","returnCode","qos","len","readUint16","topicName","parseUTF8","messageIdentifier","message","Message","subarray","retained","duplicate","destinationName","payloadMessage","writeUint16","buffer","offset","writeString","utf8Length","stringToUTF8","UTF8Length","output","charCode","charCodeAt","lowCharCode","isNaN","utf16","byte1","byte2","toString","byte3","byte4","String","fromCharCode","prototype","encode","willMessagePayloadBytes","topicStrLength","destinationNameLength","undefined","mqttVersion","clientId","willMessage","payloadBytes","Uint8Array","byteLength","userName","password","topics","requestedQos","ArrayBuffer","mbi","number","Array","numBytes","encodeMBI","byteStream","set","connectFlags","cleanSession","keepAliveInterval","Pinger","client","_client","_keepAliveInterval","isReset","pingReq","doTimeout","pinger","doPing","_trace","socket","send","timeout","setTimeout","_disconnected","reset","clearTimeout","cancel","Timeout","timeoutSeconds","action","args","ClientImpl","uri","host","port","path","WebSocket","_wsuri","_localKey","_msg_queue","_buffered_msg_queue","_sentMessages","_receivedMessages","_notify_msg_sent","_message_identifier","_sequence","restore","connected","maxMessageIdentifier","connectOptions","hostIndex","onConnected","onConnectionLost","onMessageDelivered","onMessageArrived","traceFunction","_connectTimeout","sendPinger","receivePinger","_reconnectInterval","_reconnecting","_reconnectTimeout","disconnectedPublishing","disconnectedBufferSize","receiveBuffer","_traceBuffer","_MAX_TRACE_ENTRIES","connect","connectOptionsMasked","_traceMask","uris","_doConnect","subscribe","filter","subscribeOptions","constructor","onSuccess","grantedQos","invocationContext","onFailure","errorCode","errorMessage","timeOut","_requires_ack","_schedule_message","unsubscribe","unsubscribeOptions","callback","Object","sequence","unshift","disconnect","getTraceLog","Date","startTrace","stopTrace","wsurl","useSSL","uriParts","split","join","binaryType","onopen","_on_socket_open","onmessage","_on_socket_message","onerror","_on_socket_error","onclose","_on_socket_close","_process_queue","store","prefix","storedMessage","version","pubRecReceived","hex","messageBytes","payloadHex","JSON","stringify","value","parse","x","parseInt","pop","_socket_send","messageCount","event","messages","_deframeMessages","_handleMessage","byteArray","newData","result","push","errorStack","stack","sentMessage","receivedMessage","sequencedMessages","msgId","msg","sort","a","b","pubRelMessage","reconnected","_connected","_receivePublish","_receiveMessage","pubCompMessage","wireMessageMasked","pubAckMessage","pubRecMessage","reconnect","_reconnect","errorText","readyState","close","mqttVersionExplicit","slice","call","splice","record","severity","max","shift","traceObject","masked","traceObjectMasked","attr","newPayload","payload","isView","DataView","defineProperties","payloadString","enumerable","get","newDestinationName","newQos","newRetained","topic","newTopic","newDuplicate","Client","match","ipv6AddSBracket","clientIdLength","newOnConnected","newDisconnectedPublishing","newDisconnectedBufferSize","newOnConnectionLost","newOnMessageDelivered","newOnMessageArrived","trace","hosts","ports","stringPayload","usingURIs","test","ipv6","publish","isConnected","self","window","factory","EventContribution","static","simpleHash","location","hostname","topic_base","host_client","random_id","mqtt","mqttUrl","storage","comments","functions","deleteComment","deleteMessage","highlightMessage","likeMessage","sendComment","sendNote","takeComment","Number","Math","random","now","round","performance","str","hash","endsWith","protocol","escapeHTML","txt","tmp","document","createElement","append","innerHTML","onReceive","showToast","onConnect","err","console","log","_this","retain","elem","getElementById","addFromTemplate","remove","topic_note","topic_message","topic_highlight","querySelector","topic_comment","topic_like","topic_stats","querySelectorAll","forEach","HTMLElement","dataset","bindKeypress","addEventListener","bindClick","startsWith","receiveStats","subtopic","substr","receiveComment","receiveNote","receiveMessage","paths","receiveLike","receiveHighlight","tmplId","destId","tmpl","dest","html","tmp2","firstElementChild","old","id","parentNode","replaceChild","appendChild","children","from","elem1","elem2","orderid","findClosestInput","closest","removeById","evt","target","KeyboardEvent","HTMLInputElement","date","toLocaleString","sendMessage","confirm","_this2","likes","json","liked","parts","cookie"],"mappings":"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","x_google_ignoreList":[0]}